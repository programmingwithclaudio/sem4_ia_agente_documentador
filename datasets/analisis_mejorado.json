{
  "estadisticas": {
    "total_archivos": 11,
    "archivos_procesados": 11,
    "archivos_con_errores": 0,
    "tipos_distribucion": {
      "util": 4,
      "route": 5,
      "model": 1,
      "schema": 1
    },
    "tecnologias_detectadas": [
      "pydantic",
      "fastapi",
      "sqlalchemy",
      "jwt"
    ],
    "endpoints_encontrados": 21,
    "endpoints_por_metodo": {
      "GET": 9,
      "POST": 7,
      "DELETE": 5
    },
    "clases_encontradas": 23,
    "funciones_encontradas": 35,
    "routers_detectados": 0,
    "routers_incluidos": 9
  },
  "registros": [
    {
      "tipo": "getter",
      "ruta": "app\\auth.py",
      "nombre_archivo": "auth.py",
      "elemento": "get_jwt_strategy",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Funci√≥n get_jwt_strategy() -> JWTStrategy",
      "summary": "",
      "description": "Tipo: getter | Complejidad: 1",
      "tags": "",
      "response_model": "JWTStrategy",
      "status_code": "",
      "decoradores": "",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "def get_jwt_strategy() -> JWTStrategy:\n    return JWTStrategy(\n        secret=settings.secret_key,\n        lifetime_seconds=settings.access_token_expire_minutes * 60,\n        algorithm=settings.jwt_algorithm,\n    )\n",
      "dependencias": "",
      "tecnologias": "fastapi, jwt",
      "linea_inicio": 18,
      "numero_lineas": 6,
      "complejidad": 1,
      "imports": "fastapi_users, fastapi_users.authentication, app.models, app.users_manager, app.config, fastapi",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\auth.py",
      "nombre_archivo": "auth.py",
      "elemento": "require_role",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n require_role(required_role: str)",
      "summary": "Dependency factory para verificar roles espec√≠ficos\nUso: current_user = Depends(require_role(\"ROLE_A",
      "description": "Dependency factory para verificar roles espec√≠ficos\nUso: current_user = Depends(require_role(\"ROLE_ADMIN\")) | Tipo: function | Complejidad: 3",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "required_role",
      "parametros_query": "required_role",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"required_role\": \"str\"}",
      "codigo_limpio": "async def require_role(required_role: str):\n    \"\"\"\n    Dependency factory para verificar roles espec√≠ficos\n    Uso: current_user = Depends(require_role(\"ROLE_ADMIN\"))\n    \"\"\"\n    async def _verify_role(user: User = Depends(current_active_user)):\n        user_roles = [role.name for role in user.roles]\n        if required_role not in user_roles and not user.is_superuser:\n            raise HTTPException(\n                status_code=status.HTTP_403_FORBIDDEN,\n                detail=f\"Role {required_role} required\"\n            )\n        return user\n    return _verify_role\n",
      "dependencias": "",
      "tecnologias": "fastapi, jwt",
      "linea_inicio": 44,
      "numero_lineas": 14,
      "complejidad": 3,
      "imports": "fastapi_users, fastapi_users.authentication, app.models, app.users_manager, app.config, fastapi",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\auth.py",
      "nombre_archivo": "auth.py",
      "elemento": "require_any_role",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n require_any_role()",
      "summary": "Dependency factory para verificar que tenga al menos uno de los roles\nUso: current_user = Depends(re",
      "description": "Dependency factory para verificar que tenga al menos uno de los roles\nUso: current_user = Depends(require_any_role(\"ROLE_ADMIN\", \"ROLE_MODERATOR\")) | Tipo: function | Complejidad: 3",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "async def require_any_role(*required_roles: str):\n    \"\"\"\n    Dependency factory para verificar que tenga al menos uno de los roles\n    Uso: current_user = Depends(require_any_role(\"ROLE_ADMIN\", \"ROLE_MODERATOR\"))\n    \"\"\"\n    async def _verify_roles(user: User = Depends(current_active_user)):\n        user_roles = [role.name for role in user.roles]\n        if not any(role in user_roles for role in required_roles) and not user.is_superuser:\n            raise HTTPException(\n                status_code=status.HTTP_403_FORBIDDEN,\n                detail=f\"One of these roles required: {', '.join(required_roles)}\"\n            )\n        return user\n    return _verify_roles\n",
      "dependencias": "",
      "tecnologias": "fastapi, jwt",
      "linea_inicio": 60,
      "numero_lineas": 14,
      "complejidad": 3,
      "imports": "fastapi_users, fastapi_users.authentication, app.models, app.users_manager, app.config, fastapi",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\auth.py",
      "nombre_archivo": "auth.py",
      "elemento": "admin_required",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n admin_required(user: User)",
      "summary": "Dependency para verificar que sea admin o superuser",
      "description": "Dependency para verificar que sea admin o superuser | Tipo: function | Complejidad: 3",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "user",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"user\": \"User\"}",
      "codigo_limpio": "async def admin_required(user: User = Depends(current_active_user)):\n    \"\"\"Dependency para verificar que sea admin o superuser\"\"\"\n    user_roles = [role.name for role in user.roles]\n    if \"ROLE_ADMIN\" not in user_roles and not user.is_superuser:\n        raise HTTPException(\n            status_code=status.HTTP_403_FORBIDDEN,\n            detail=\"Admin privileges required\"\n        )\n    return user",
      "dependencias": "",
      "tecnologias": "fastapi, jwt",
      "linea_inicio": 76,
      "numero_lineas": 9,
      "complejidad": 3,
      "imports": "fastapi_users, fastapi_users.authentication, app.models, app.users_manager, app.config, fastapi",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\auth.py",
      "nombre_archivo": "auth.py",
      "elemento": "_verify_role",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n _verify_role(user: User)",
      "summary": "",
      "description": "Tipo: function | Complejidad: 3",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "user",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"user\": \"User\"}",
      "codigo_limpio": "    async def _verify_role(user: User = Depends(current_active_user)):\n        user_roles = [role.name for role in user.roles]\n        if required_role not in user_roles and not user.is_superuser:\n            raise HTTPException(\n                status_code=status.HTTP_403_FORBIDDEN,\n                detail=f\"Role {required_role} required\"\n            )\n        return user\n",
      "dependencias": "",
      "tecnologias": "fastapi, jwt",
      "linea_inicio": 49,
      "numero_lineas": 8,
      "complejidad": 3,
      "imports": "fastapi_users, fastapi_users.authentication, app.models, app.users_manager, app.config, fastapi",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\auth.py",
      "nombre_archivo": "auth.py",
      "elemento": "_verify_roles",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n _verify_roles(user: User)",
      "summary": "",
      "description": "Tipo: function | Complejidad: 3",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "user",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"user\": \"User\"}",
      "codigo_limpio": "    async def _verify_roles(user: User = Depends(current_active_user)):\n        user_roles = [role.name for role in user.roles]\n        if not any(role in user_roles for role in required_roles) and not user.is_superuser:\n            raise HTTPException(\n                status_code=status.HTTP_403_FORBIDDEN,\n                detail=f\"One of these roles required: {', '.join(required_roles)}\"\n            )\n        return user\n",
      "dependencias": "",
      "tecnologias": "fastapi, jwt",
      "linea_inicio": 65,
      "numero_lineas": 8,
      "complejidad": 3,
      "imports": "fastapi_users, fastapi_users.authentication, app.models, app.users_manager, app.config, fastapi",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "class",
      "ruta": "app\\config.py",
      "nombre_archivo": "config.py",
      "elemento": "Settings",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase Settings (hereda: BaseSettings)",
      "summary": "Configuraci√≥n centralizada de la aplicaci√≥n",
      "description": "Configuraci√≥n centralizada de la aplicaci√≥n | 28 atributos | 1 m√©todos",
      "tags": "BaseSettings",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "database_url, database_sync_url, redis_url, secret_key, jwt_algorithm, access_token_expire_minutes, refresh_token_expire_days, password_hash_schemes, mail_username, mail_password",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"database_url\": \"str\", \"database_sync_url\": \"str\", \"redis_url\": \"str\", \"secret_key\": \"str\", \"jwt_algorithm\": \"str\", \"access_token_expire_minutes\": \"int\", \"refresh_token_expire_days\": \"int\", \"password_hash_schemes\": \"List[str]\", \"mail_username\": \"str\", \"mail_password\": \"str\", \"mail_from\": \"str\", \"mail_port\": \"int\", \"mail_server\": \"str\", \"mail_from_name\": \"str\", \"mail_tls\": \"bool\", \"mail_ssl\": \"bool\", \"frontend_url\": \"str\", \"google_client_id\": \"str\", \"google_client_secret\": \"str\", \"github_client_id\": \"str\", \"github_client_secret\": \"str\", \"allowed_origins\": \"str\", \"rate_limit_per_minute\": \"int\", \"rate_limit_per_hour\": \"int\", \"rate_limit_enabled\": \"bool\", \"environment\": \"str\", \"app_name\": \"str\"}",
      "codigo_limpio": "class Settings(BaseSettings):\n    \"\"\"Configuraci√≥n centralizada de la aplicaci√≥n\"\"\"\n    \n    # Database\n    database_url: str = \"postgresql+asyncpg://postgres:mermaiddev@localhost:5432/auth_db\"\n    database_sync_url: str = \"postgresql://postgres:mermaiddev@localhost:5432/auth_db\"\n    \n    # Redis\n    redis_url: str = \"redis://localhost:6379/0\"\n\n    # Security - JWT\n    secret_key: str = \"change-this-super-secret-key\"\n    jwt_algorithm: str = \"HS256\" \n    access_token_expire_minutes: int = 30\n    refresh_token_expire_days: int = 7\n    \n    # Security - Password Hashing\n    password_hash_schemes: List[str] = [\"argon2\", \"bcrypt\"]\n    \n    # Email\n    mail_username: str = \"\"\n    mail_password: str = \"\"\n    mail_from: str = \"clblommberg@gmail.com\"\n    mail_port: int = 587\n    mail_server: str = \"smtp.gmail.com\"\n    mail_from_name: str = \"Auth Service\"\n    mail_tls: bool = True\n    mail_ssl: bool = False\n    \n    # Frontend\n    frontend_url: str = \"http://localhost:3000\"\n    \n    # OAuth2 (opcional)\n    google_client_id: str = \"\"\n    google_client_secret: str = \"\"\n    github_client_id: str = \"\"\n    github_client_secret: str = \"\"\n    \n    # CORS\n    allowed_origins: str = \"http://localhost:3000,http://localhost:8000\"\n    \n    # Rate Limiting\n    rate_limit_per_minute: int = 10\n    rate_limit_per_hour: int = 100\n    rate_limit_enabled: bool = True\n    \n    # Environment\n    environment: str = \"development\"\n    app_name: str = \"FastAPI Auth Service\"\n    \n    model_config = SettingsConfigDict(\n        env_file=\".env\",\n        env_file_encoding=\"utf-8\",\n        extra=\"allow\"\n    )\n    \n    @property\n    def origins_list(self) -> List[str]:\n        \"\"\"Convierte string de or√≠genes separados por comas en lista\"\"\"\n        return [origin.strip() for origin in self.allowed_origins.split(\",\")]\n",
      "dependencias": "",
      "tecnologias": "pydantic, fastapi, jwt",
      "linea_inicio": 6,
      "numero_lineas": 60,
      "complejidad": 2,
      "imports": "pydantic_settings, typing",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "config",
      "ruta": "app\\config.py",
      "nombre_archivo": "config.py",
      "elemento": "Settings",
      "categoria": "CONFIG_CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "CONFIG_CLASS: Settings",
      "summary": "CONFIG_CLASS variable",
      "description": "Valor: Configuration Class",
      "tags": "CONFIG_CLASS",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "Settings = Configuration Class",
      "dependencias": "",
      "tecnologias": "pydantic, fastapi, jwt",
      "linea_inicio": 6,
      "numero_lineas": 1,
      "complejidad": 1,
      "imports": "pydantic_settings, typing",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "config",
      "ruta": "app\\config.py",
      "nombre_archivo": "config.py",
      "elemento": "settings",
      "categoria": "VARIABLE",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "VARIABLE: settings = Settings()",
      "summary": "VARIABLE variable",
      "description": "Valor: Settings()",
      "tags": "VARIABLE",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "settings = Settings()",
      "dependencias": "",
      "tecnologias": "pydantic, fastapi, jwt",
      "linea_inicio": 68,
      "numero_lineas": 1,
      "complejidad": 1,
      "imports": "pydantic_settings, typing",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\email.py",
      "nombre_archivo": "email.py",
      "elemento": "send_verification_email",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n send_verification_email(email: str, token: str)",
      "summary": "Env√≠a email de verificaci√≥n",
      "description": "Env√≠a email de verificaci√≥n | Tipo: function | Complejidad: 1",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "email, token",
      "parametros_query": "email, token",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"email\": \"str\", \"token\": \"str\"}",
      "codigo_limpio": "async def send_verification_email(email: str, token: str):\n    \"\"\"Env√≠a email de verificaci√≥n\"\"\"\n    \n    verification_url = f\"{settings.frontend_url}/verify-email?token={token}\"\n    \n    html = f\"\"\"\n    <!DOCTYPE html>\n    <html>\n    <head>\n        <style>\n            body {{ font-family: Arial, sans-serif; line-height: 1.6; color: #333; }}\n            .container {{ max-width: 600px; margin: 0 auto; padding: 20px; }}\n            .header {{ background: #4F46E5; color: white; padding: 20px; text-align: center; }}\n            .content {{ background: #f9f9f9; padding: 30px; }}\n            .button {{ \n                display: inline-block; \n                padding: 12px 30px; \n                background: #4F46E5; \n                color: white; \n                text-decoration: none; \n                border-radius: 5px;\n                margin: 20px 0;\n            }}\n            .footer {{ text-align: center; padding: 20px; font-size: 12px; color: #666; }}\n        </style>\n    </head>\n    <body>\n        <div class=\"container\">\n            <div class=\"header\">\n                <h1>Verifica tu Email</h1>\n            </div>\n            <div class=\"content\">\n                <p>¬°Hola!</p>\n                <p>Gracias por registrarte. Por favor, verifica tu direcci√≥n de email haciendo clic en el bot√≥n de abajo:</p>\n                <div style=\"text-align: center;\">\n                    <a href=\"{verification_url}\" class=\"button\">Verificar Email</a>\n                </div>\n                <p>O copia y pega este enlace en tu navegador:</p>\n                <p style=\"word-break: break-all; color: #4F46E5;\">{verification_url}</p>\n                <p><strong>Este enlace expira en 1 hora.</strong></p>\n                <p>Si no te registraste en nuestra plataforma, ignora este email.</p>\n            </div>\n            <div class=\"footer\">\n                <p>&copy; 2025 Auth Service. Todos los derechos reservados.</p>\n            </div>\n        </div>\n    </body>\n    </html>\n    \"\"\"\n    \n    me\n... (truncado)",
      "dependencias": "",
      "tecnologias": "fastapi",
      "linea_inicio": 22,
      "numero_lineas": 58,
      "complejidad": 1,
      "imports": "fastapi_mail, app.config",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\email.py",
      "nombre_archivo": "email.py",
      "elemento": "send_password_reset_email",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n send_password_reset_email(email: str, token: str)",
      "summary": "Env√≠a email de recuperaci√≥n de contrase√±a",
      "description": "Env√≠a email de recuperaci√≥n de contrase√±a | Tipo: function | Complejidad: 1",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "email, token",
      "parametros_query": "email, token",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"email\": \"str\", \"token\": \"str\"}",
      "codigo_limpio": "async def send_password_reset_email(email: str, token: str):\n    \"\"\"Env√≠a email de recuperaci√≥n de contrase√±a\"\"\"\n    \n    reset_url = f\"{settings.frontend_url}/reset-password?token={token}\"\n    \n    html = f\"\"\"\n    <!DOCTYPE html>\n    <html>\n    <head>\n        <style>\n            body {{ font-family: Arial, sans-serif; line-height: 1.6; color: #333; }}\n            .container {{ max-width: 600px; margin: 0 auto; padding: 20px; }}\n            .header {{ background: #EF4444; color: white; padding: 20px; text-align: center; }}\n            .content {{ background: #f9f9f9; padding: 30px; }}\n            .button {{ \n                display: inline-block; \n                padding: 12px 30px; \n                background: #EF4444; \n                color: white; \n                text-decoration: none; \n                border-radius: 5px;\n                margin: 20px 0;\n            }}\n            .footer {{ text-align: center; padding: 20px; font-size: 12px; color: #666; }}\n        </style>\n    </head>\n    <body>\n        <div class=\"container\">\n            <div class=\"header\">\n                <h1>Recupera tu Contrase√±a</h1>\n            </div>\n            <div class=\"content\">\n                <p>¬°Hola!</p>\n                <p>Recibimos una solicitud para restablecer tu contrase√±a. Haz clic en el bot√≥n de abajo para crear una nueva:</p>\n                <div style=\"text-align: center;\">\n                    <a href=\"{reset_url}\" class=\"button\">Restablecer Contrase√±a</a>\n                </div>\n                <p>O copia y pega este enlace en tu navegador:</p>\n                <p style=\"word-break: break-all; color: #EF4444;\">{reset_url}</p>\n                <p><strong>Este enlace expira en 1 hora.</strong></p>\n                <p>Si no solicitaste este cambio, ignora este email y tu contrase√±a permanecer√° sin cambios.</p>\n            </div>\n            <div class=\"footer\">\n                <p>&copy; 2025 Auth Service. Todos los derechos reservados.</p>\n            </div>\n        </div>\n  \n... (truncado)",
      "dependencias": "",
      "tecnologias": "fastapi",
      "linea_inicio": 82,
      "numero_lineas": 58,
      "complejidad": 1,
      "imports": "fastapi_mail, app.config",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\email.py",
      "nombre_archivo": "email.py",
      "elemento": "send_welcome_email",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n send_welcome_email(email: str, username: str)",
      "summary": "Env√≠a email de bienvenida despu√©s de verificar",
      "description": "Env√≠a email de bienvenida despu√©s de verificar | Tipo: function | Complejidad: 1",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "email, username",
      "parametros_query": "email, username",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"email\": \"str\", \"username\": \"str\"}",
      "codigo_limpio": "async def send_welcome_email(email: str, username: str):\n    \"\"\"Env√≠a email de bienvenida despu√©s de verificar\"\"\"\n    \n    html = f\"\"\"\n    <!DOCTYPE html>\n    <html>\n    <head>\n        <style>\n            body {{ font-family: Arial, sans-serif; line-height: 1.6; color: #333; }}\n            .container {{ max-width: 600px; margin: 0 auto; padding: 20px; }}\n            .header {{ background: #10B981; color: white; padding: 20px; text-align: center; }}\n            .content {{ background: #f9f9f9; padding: 30px; }}\n            .footer {{ text-align: center; padding: 20px; font-size: 12px; color: #666; }}\n        </style>\n    </head>\n    <body>\n        <div class=\"container\">\n            <div class=\"header\">\n                <h1>¬°Bienvenido, {username}!</h1>\n            </div>\n            <div class=\"content\">\n                <p>Tu cuenta ha sido verificada exitosamente.</p>\n                <p>Ahora puedes acceder a todas las funcionalidades de nuestra plataforma.</p>\n                <p>Si tienes alguna pregunta, no dudes en contactarnos.</p>\n            </div>\n            <div class=\"footer\">\n                <p>&copy; 2025 Auth Service. Todos los derechos reservados.</p>\n            </div>\n        </div>\n    </body>\n    </html>\n    \"\"\"\n    \n    message = MessageSchema(\n        subject=f\"¬°Bienvenido, {username}!\",\n        recipients=[email],\n        body=html,\n        subtype=\"html\"\n    )\n    \n    await fm.send_message(message)",
      "dependencias": "",
      "tecnologias": "fastapi",
      "linea_inicio": 142,
      "numero_lineas": 41,
      "complejidad": 1,
      "imports": "fastapi_mail, app.config",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\main.py",
      "nombre_archivo": "main.py",
      "elemento": "root",
      "categoria": "ENDPOINT",
      "endpoint": "/",
      "metodo_http": "GET",
      "descripcion": "GET /",
      "summary": "",
      "description": "",
      "tags": "root",
      "response_model": "",
      "status_code": "",
      "decoradores": "@app.get(\"/\", tags=[\"root\"])",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "async def root():\n    \"\"\"Endpoint ra√≠z\"\"\"\n    return {\n        \"service\": \"Auth Microservice\",\n        \"version\": \"2.0.0\",\n        \"status\": \"running\",\n        \"docs\": \"/docs\"\n    }",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 177,
      "numero_lineas": 8,
      "complejidad": 4,
      "imports": "contextlib, fastapi, fastapi.middleware.cors, fastapi.responses, slowapi, slowapi.util, slowapi.errors, sqlalchemy.ext.asyncio, app.config, app.models",
      "router_padre": "app",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[{\"router\": \"\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 112}, {\"router\": \"UserRead\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 119}, {\"router\": \"\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 126}, {\"router\": \"\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 133}, {\"router\": \"UserRead\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 140}, {\"router\": \"users_router\", \"prefix\": \"/api\", \"tags\": \"\\\"users-extended\\\"\", \"linea\": 149}, {\"router\": \"admin_router\", \"prefix\": \"/api/admin\", \"tags\": \"\\\"admin\\\"\", \"linea\": 156}, {\"router\": \"roles_router\", \"prefix\": \"/api/roles\", \"tags\": \"\\\"roles\\\"\", \"linea\": 163}, {\"router\": \"health_router\", \"prefix\": \"/api/health\", \"tags\": \"\\\"health\\\"\", \"linea\": 170}]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\main.py",
      "nombre_archivo": "main.py",
      "elemento": "lifespan",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n lifespan(app: FastAPI)",
      "summary": "Contexto de vida de la aplicaci√≥n\nSe ejecuta al iniciar y al cerrar",
      "description": "Contexto de vida de la aplicaci√≥n\nSe ejecuta al iniciar y al cerrar | Tipo: function | Complejidad: 1",
      "tags": "asynccontextmanager",
      "response_model": "",
      "status_code": "",
      "decoradores": "asynccontextmanager",
      "parametros": "app",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"app\": \"FastAPI\"}",
      "codigo_limpio": "async def lifespan(app: FastAPI):\n    \"\"\"\n    Contexto de vida de la aplicaci√≥n\n    Se ejecuta al iniciar y al cerrar\n    \"\"\"\n    # STARTUP\n    logger.info(\"üöÄ Iniciando Auth Service...\")\n    \n    # Crear tablas\n    await create_db_and_tables()\n    logger.info(\"‚úÖ Tablas de BD creadas/verificadas\")\n    \n    # Crear roles por defecto\n    async for session in get_async_session():\n        await initialize_roles(session)\n        break\n    \n    logger.info(\"‚úÖ Roles inicializados\")\n    logger.info(\"üéâ Auth Service listo!\")\n    \n    yield\n    \n    # SHUTDOWN\n    logger.info(\"üëã Cerrando Auth Service...\")\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 26,
      "numero_lineas": 24,
      "complejidad": 1,
      "imports": "contextlib, fastapi, fastapi.middleware.cors, fastapi.responses, slowapi, slowapi.util, slowapi.errors, sqlalchemy.ext.asyncio, app.config, app.models",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[{\"router\": \"\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 112}, {\"router\": \"UserRead\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 119}, {\"router\": \"\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 126}, {\"router\": \"\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 133}, {\"router\": \"UserRead\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 140}, {\"router\": \"users_router\", \"prefix\": \"/api\", \"tags\": \"\\\"users-extended\\\"\", \"linea\": 149}, {\"router\": \"admin_router\", \"prefix\": \"/api/admin\", \"tags\": \"\\\"admin\\\"\", \"linea\": 156}, {\"router\": \"roles_router\", \"prefix\": \"/api/roles\", \"tags\": \"\\\"roles\\\"\", \"linea\": 163}, {\"router\": \"health_router\", \"prefix\": \"/api/health\", \"tags\": \"\\\"health\\\"\", \"linea\": 170}]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\main.py",
      "nombre_archivo": "main.py",
      "elemento": "initialize_roles",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n initialize_roles(session: AsyncSession)",
      "summary": "Inicializa roles por defecto en la BD",
      "description": "Inicializa roles por defecto en la BD | Tipo: function | Complejidad: 3",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "session",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"session\": \"AsyncSession\"}",
      "codigo_limpio": "async def initialize_roles(session: AsyncSession):\n    \"\"\"Inicializa roles por defecto en la BD\"\"\"\n    from sqlalchemy import select\n    \n    default_roles = [\n        {\"name\": \"ROLE_USER\", \"description\": \"Usuario est√°ndar\"},\n        {\"name\": \"ROLE_MODERATOR\", \"description\": \"Moderador con permisos intermedios\"},\n        {\"name\": \"ROLE_ADMIN\", \"description\": \"Administrador con todos los permisos\"},\n    ]\n    \n    for role_data in default_roles:\n        result = await session.execute(\n            select(Role).where(Role.name == role_data[\"name\"])\n        )\n        existing_role = result.scalar_one_or_none()\n        \n        if not existing_role:\n            new_role = Role(**role_data)\n            session.add(new_role)\n    \n    await session.commit()\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 52,
      "numero_lineas": 21,
      "complejidad": 3,
      "imports": "contextlib, fastapi, fastapi.middleware.cors, fastapi.responses, slowapi, slowapi.util, slowapi.errors, sqlalchemy.ext.asyncio, app.config, app.models",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[{\"router\": \"\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 112}, {\"router\": \"UserRead\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 119}, {\"router\": \"\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 126}, {\"router\": \"\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 133}, {\"router\": \"UserRead\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 140}, {\"router\": \"users_router\", \"prefix\": \"/api\", \"tags\": \"\\\"users-extended\\\"\", \"linea\": 149}, {\"router\": \"admin_router\", \"prefix\": \"/api/admin\", \"tags\": \"\\\"admin\\\"\", \"linea\": 156}, {\"router\": \"roles_router\", \"prefix\": \"/api/roles\", \"tags\": \"\\\"roles\\\"\", \"linea\": 163}, {\"router\": \"health_router\", \"prefix\": \"/api/health\", \"tags\": \"\\\"health\\\"\", \"linea\": 170}]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\main.py",
      "nombre_archivo": "main.py",
      "elemento": "global_exception_handler",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n global_exception_handler(request: Request, exc: Exception)",
      "summary": "Handler global de excepciones",
      "description": "Handler global de excepciones | Tipo: function | Complejidad: 1",
      "tags": "app.exception_handler(Exception)",
      "response_model": "",
      "status_code": "",
      "decoradores": "app.exception_handler(Exception)",
      "parametros": "request, exc",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"request\": \"Request\", \"exc\": \"Exception\"}",
      "codigo_limpio": "async def global_exception_handler(request: Request, exc: Exception):\n    \"\"\"Handler global de excepciones\"\"\"\n    logger.error(f\"‚ùå Error no manejado: {exc}\", exc_info=True)\n    return JSONResponse(\n        status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n        content={\"detail\": \"Internal server error\"}\n    )\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 102,
      "numero_lineas": 7,
      "complejidad": 1,
      "imports": "contextlib, fastapi, fastapi.middleware.cors, fastapi.responses, slowapi, slowapi.util, slowapi.errors, sqlalchemy.ext.asyncio, app.config, app.models",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[{\"router\": \"\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 112}, {\"router\": \"UserRead\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 119}, {\"router\": \"\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 126}, {\"router\": \"\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 133}, {\"router\": \"UserRead\", \"prefix\": \"\", \"tags\": \"\", \"linea\": 140}, {\"router\": \"users_router\", \"prefix\": \"/api\", \"tags\": \"\\\"users-extended\\\"\", \"linea\": 149}, {\"router\": \"admin_router\", \"prefix\": \"/api/admin\", \"tags\": \"\\\"admin\\\"\", \"linea\": 156}, {\"router\": \"roles_router\", \"prefix\": \"/api/roles\", \"tags\": \"\\\"roles\\\"\", \"linea\": 163}, {\"router\": \"health_router\", \"prefix\": \"/api/health\", \"tags\": \"\\\"health\\\"\", \"linea\": 170}]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "model_orm",
      "ruta": "app\\models.py",
      "nombre_archivo": "models.py",
      "elemento": "Base",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase Base (hereda: DeclarativeBase)",
      "summary": "",
      "description": "",
      "tags": "DeclarativeBase",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "class Base(DeclarativeBase):\n    pass\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 13,
      "numero_lineas": 2,
      "complejidad": 1,
      "imports": "datetime, typing, fastapi, fastapi_users.db, sqlalchemy, sqlalchemy.ext.asyncio, sqlalchemy.orm, app.config",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "model_orm",
      "ruta": "app\\models.py",
      "nombre_archivo": "models.py",
      "elemento": "Role",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase Role (hereda: Base)",
      "summary": "Modelo de roles",
      "description": "Modelo de roles | 5 atributos | 1 m√©todos | 4 relaciones ORM",
      "tags": "Base",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "__tablename__, id, name, description, users",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"id\": \"Mapped[int]\", \"name\": \"Mapped[str]\", \"description\": \"Mapped[str]\", \"users\": \"Mapped[list['User']]\"}",
      "codigo_limpio": "class Role(Base):\n    \"\"\"Modelo de roles\"\"\"\n    __tablename__ = 'roles'\n    \n    id: Mapped[int] = mapped_column(Integer, primary_key=True, index=True)\n    name: Mapped[str] = mapped_column(String(50), unique=True, nullable=False)\n    description: Mapped[str] = mapped_column(String(255), nullable=True)\n    \n    users: Mapped[list[\"User\"]] = relationship(\n        \"User\",\n        secondary=user_roles,\n        back_populates=\"roles\"\n    )\n    \n    def __repr__(self):\n        return f\"<Role {self.name}>\"\n",
      "dependencias": "Mapped[int], Mapped[str], Mapped[str], Mapped[list['User']]",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 24,
      "numero_lineas": 16,
      "complejidad": 1,
      "imports": "datetime, typing, fastapi, fastapi_users.db, sqlalchemy, sqlalchemy.ext.asyncio, sqlalchemy.orm, app.config",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "model_orm",
      "ruta": "app\\models.py",
      "nombre_archivo": "models.py",
      "elemento": "User",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase User (hereda: SQLAlchemyBaseUserTable[int], Base)",
      "summary": "Modelo de usuario extendido de FastAPI Users\nIncluye campos adicionales personalizados",
      "description": "Modelo de usuario extendido de FastAPI Users\nIncluye campos adicionales personalizados | 17 atributos | 1 m√©todos | 16 relaciones ORM",
      "tags": "SQLAlchemyBaseUserTable[int], Base",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "__tablename__, id, username, first_name, last_name, phone, avatar_url, bio, created_at, updated_at",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"id\": \"Mapped[int]\", \"username\": \"Mapped[str]\", \"first_name\": \"Mapped[str]\", \"last_name\": \"Mapped[str]\", \"phone\": \"Mapped[str]\", \"avatar_url\": \"Mapped[str]\", \"bio\": \"Mapped[str]\", \"created_at\": \"Mapped[datetime]\", \"updated_at\": \"Mapped[datetime]\", \"last_login\": \"Mapped[datetime]\", \"failed_login_attempts\": \"Mapped[int]\", \"locked_until\": \"Mapped[datetime]\", \"oauth_provider\": \"Mapped[str]\", \"oauth_id\": \"Mapped[str]\", \"roles\": \"Mapped[list[Role]]\", \"sessions\": \"Mapped[list['UserSession']]\"}",
      "codigo_limpio": "class User(SQLAlchemyBaseUserTable[int], Base):\n    \"\"\"\n    Modelo de usuario extendido de FastAPI Users\n    Incluye campos adicionales personalizados\n    \"\"\"\n    __tablename__ = 'users'\n\n    # Campos heredados de FastAPIUsers:\n    # - id (pk)\n    # - email (unique, indexed)\n    # - hashed_password\n    # - is_active (bool)\n    # - is_superuser (bool)\n    # - is_verified (bool)\n       \n    id: Mapped[int] = mapped_column(Integer, primary_key=True, index=True)\n    # Campos personalizados\n    username: Mapped[str] = mapped_column(String(50), unique=True, index=True, nullable=False)\n    first_name: Mapped[str] = mapped_column(String(100), nullable=True)\n    last_name: Mapped[str] = mapped_column(String(100), nullable=True)\n    phone: Mapped[str] = mapped_column(String(20), nullable=True)\n    # Avatar/Profile\n    avatar_url: Mapped[str] = mapped_column(String(500), nullable=True)\n    bio: Mapped[str] = mapped_column(Text, nullable=True)\n    # Timestamps\n    created_at: Mapped[datetime] = mapped_column(DateTime, default=datetime.utcnow)\n    updated_at: Mapped[datetime] = mapped_column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\n    last_login: Mapped[datetime] = mapped_column(DateTime, nullable=True)\n    # Seguridad\n    failed_login_attempts: Mapped[int] = mapped_column(Integer, default=0)\n    locked_until: Mapped[datetime] = mapped_column(DateTime, nullable=True)\n    # OAuth providers\n    oauth_provider: Mapped[str] = mapped_column(String(50), nullable=True)\n    oauth_id: Mapped[str] = mapped_column(String(255), nullable=True)\n    \n    # Relaciones\n    roles: Mapped[list[Role]] = relationship(\n        \"Role\",\n        secondary=user_roles,\n        back_populates=\"users\",\n        lazy=\"selectin\"\n    )\n    \n    sessions: Mapped[list[\"UserSession\"]] = relationship(\n        \"UserSession\",\n        back_populates=\"user\",\n        cascade=\"all, delete-orphan\"\n    )\n    \n    def __repr__(self):\n        return f\"<User {self.username} - {self.email}>\"\n",
      "dependencias": "Mapped[int], Mapped[str], Mapped[str], Mapped[str], Mapped[str]",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 41,
      "numero_lineas": 51,
      "complejidad": 1,
      "imports": "datetime, typing, fastapi, fastapi_users.db, sqlalchemy, sqlalchemy.ext.asyncio, sqlalchemy.orm, app.config",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "model_orm",
      "ruta": "app\\models.py",
      "nombre_archivo": "models.py",
      "elemento": "UserSession",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase UserSession (hereda: Base)",
      "summary": "Auditor√≠a de sesiones de usuario\nPermite rastrear logins, dispositivos, IPs, etc.",
      "description": "Auditor√≠a de sesiones de usuario\nPermite rastrear logins, dispositivos, IPs, etc. | 14 atributos | 1 m√©todos | 13 relaciones ORM",
      "tags": "Base",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "__tablename__, id, user_id, access_token_jti, refresh_token_jti, ip_address, user_agent, device_type, created_at, expires_at",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"id\": \"Mapped[int]\", \"user_id\": \"Mapped[int]\", \"access_token_jti\": \"Mapped[str]\", \"refresh_token_jti\": \"Mapped[str]\", \"ip_address\": \"Mapped[str]\", \"user_agent\": \"Mapped[str]\", \"device_type\": \"Mapped[str]\", \"created_at\": \"Mapped[datetime]\", \"expires_at\": \"Mapped[datetime]\", \"last_activity\": \"Mapped[datetime]\", \"is_active\": \"Mapped[bool]\", \"revoked_at\": \"Mapped[datetime]\", \"user\": \"Mapped[User]\"}",
      "codigo_limpio": "class UserSession(Base):\n    \"\"\"\n    Auditor√≠a de sesiones de usuario\n    Permite rastrear logins, dispositivos, IPs, etc.\n    \"\"\"\n    __tablename__ = 'user_sessions'\n    \n    id: Mapped[int] = mapped_column(Integer, primary_key=True, index=True)\n    user_id: Mapped[int] = mapped_column(Integer, ForeignKey('users.id', ondelete='CASCADE'), nullable=False)\n    \n    # Token info\n    access_token_jti: Mapped[str] = mapped_column(String(255), unique=True, nullable=False)\n    refresh_token_jti: Mapped[str] = mapped_column(String(255), unique=True, nullable=True)\n    \n    # Device/Client info\n    ip_address: Mapped[str] = mapped_column(String(45), nullable=True)\n    user_agent: Mapped[str] = mapped_column(String(500), nullable=True)\n    device_type: Mapped[str] = mapped_column(String(50), nullable=True)  # mobile, desktop, tablet\n    \n    # Timestamps\n    created_at: Mapped[datetime] = mapped_column(DateTime, default=datetime.utcnow)\n    expires_at: Mapped[datetime] = mapped_column(DateTime, nullable=False)\n    last_activity: Mapped[datetime] = mapped_column(DateTime, default=datetime.utcnow)\n    \n    # Estado\n    is_active: Mapped[bool] = mapped_column(Boolean, default=True)\n    revoked_at: Mapped[datetime] = mapped_column(DateTime, nullable=True)\n    \n    # Relaci√≥n\n    user: Mapped[User] = relationship(\"User\", back_populates=\"sessions\")\n    \n    def __repr__(self):\n        return f\"<Session {self.id} - User {self.user_id}>\"\n",
      "dependencias": "Mapped[int], Mapped[int], Mapped[str], Mapped[str], Mapped[str]",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 94,
      "numero_lineas": 33,
      "complejidad": 1,
      "imports": "datetime, typing, fastapi, fastapi_users.db, sqlalchemy, sqlalchemy.ext.asyncio, sqlalchemy.orm, app.config",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "factory",
      "ruta": "app\\models.py",
      "nombre_archivo": "models.py",
      "elemento": "create_db_and_tables",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n create_db_and_tables()",
      "summary": "Crea las tablas en la base de datos",
      "description": "Crea las tablas en la base de datos | Tipo: factory | Complejidad: 1",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "async def create_db_and_tables():\n    \"\"\"Crea las tablas en la base de datos\"\"\"\n    async with engine.begin() as conn:\n        await conn.run_sync(Base.metadata.create_all)\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 146,
      "numero_lineas": 4,
      "complejidad": 1,
      "imports": "datetime, typing, fastapi, fastapi_users.db, sqlalchemy, sqlalchemy.ext.asyncio, sqlalchemy.orm, app.config",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "getter",
      "ruta": "app\\models.py",
      "nombre_archivo": "models.py",
      "elemento": "get_async_session",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n get_async_session() -> AsyncGenerator[AsyncSession, None]",
      "summary": "Dependency para obtener sesi√≥n async de DB",
      "description": "Dependency para obtener sesi√≥n async de DB | Tipo: getter | Complejidad: 1",
      "tags": "",
      "response_model": "AsyncGenerator[AsyncSession, None]",
      "status_code": "",
      "decoradores": "",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "async def get_async_session() -> AsyncGenerator[AsyncSession, None]:\n    \"\"\"Dependency para obtener sesi√≥n async de DB\"\"\"\n    async with async_session_maker() as session:\n        yield session\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 152,
      "numero_lineas": 4,
      "complejidad": 1,
      "imports": "datetime, typing, fastapi, fastapi_users.db, sqlalchemy, sqlalchemy.ext.asyncio, sqlalchemy.orm, app.config",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "getter",
      "ruta": "app\\models.py",
      "nombre_archivo": "models.py",
      "elemento": "get_user_db",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n get_user_db(session: AsyncSession)",
      "summary": "Dependency para FastAPI Users",
      "description": "Dependency para FastAPI Users | Tipo: getter | Complejidad: 1",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "session",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"session\": \"AsyncSession\"}",
      "codigo_limpio": "async def get_user_db(session: AsyncSession = Depends(get_async_session)):\n    \"\"\"Dependency para FastAPI Users\"\"\"\n    yield SQLAlchemyUserDatabase(session, User)",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 158,
      "numero_lineas": 3,
      "complejidad": 1,
      "imports": "datetime, typing, fastapi, fastapi_users.db, sqlalchemy, sqlalchemy.ext.asyncio, sqlalchemy.orm, app.config",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "class",
      "ruta": "app\\schemas.py",
      "nombre_archivo": "schemas.py",
      "elemento": "UserRead",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase UserRead (hereda: schemas.BaseUser[int])",
      "summary": "Schema para leer usuarios",
      "description": "Schema para leer usuarios | 9 atributos | 1 m√©todos",
      "tags": "schemas.BaseUser[int]",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "username, first_name, last_name, phone, avatar_url, bio, created_at, last_login, roles",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"username\": \"str\", \"first_name\": \"Optional[str]\", \"last_name\": \"Optional[str]\", \"phone\": \"Optional[str]\", \"avatar_url\": \"Optional[str]\", \"bio\": \"Optional[str]\", \"created_at\": \"datetime\", \"last_login\": \"Optional[datetime]\", \"roles\": \"List[str]\"}",
      "codigo_limpio": "class UserRead(schemas.BaseUser[int]):\n    \"\"\"Schema para leer usuarios\"\"\"\n    username: str\n    first_name: Optional[str] = None\n    last_name: Optional[str] = None\n    phone: Optional[str] = None\n    avatar_url: Optional[str] = None\n    bio: Optional[str] = None\n    created_at: datetime\n    last_login: Optional[datetime] = None\n    roles: List[str] = []\n    \n    # VALIDADOR PARA CONVERTIR ROLES A STRINGS\n    @field_validator('roles', mode='before')\n    @classmethod\n    def convert_roles_to_strings(cls, v):\n        \"\"\"Convierte objetos Role a strings\"\"\"\n        if not v:\n            return []\n        \n        # Si ya son strings, retornar tal cual\n        if isinstance(v, list) and all(isinstance(item, str) for item in v):\n            return v\n        \n        # Si son objetos Role, extraer el nombre\n        try:\n            return [role.name if hasattr(role, 'name') else str(role) for role in v]\n        except (AttributeError, TypeError):\n            return []\n    \n    class Config:\n        from_attributes = True\n",
      "dependencias": "",
      "tecnologias": "pydantic, fastapi",
      "linea_inicio": 8,
      "numero_lineas": 32,
      "complejidad": 14,
      "imports": "datetime, typing, fastapi_users, pydantic",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "class",
      "ruta": "app\\schemas.py",
      "nombre_archivo": "schemas.py",
      "elemento": "UserCreate",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase UserCreate (hereda: schemas.BaseUserCreate)",
      "summary": "Schema para crear usuarios",
      "description": "Schema para crear usuarios | 4 atributos",
      "tags": "schemas.BaseUserCreate",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "username, first_name, last_name, phone",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"username\": \"str\", \"first_name\": \"Optional[str]\", \"last_name\": \"Optional[str]\", \"phone\": \"Optional[str]\"}",
      "codigo_limpio": "class UserCreate(schemas.BaseUserCreate):\n    \"\"\"Schema para crear usuarios\"\"\"\n    username: str\n    first_name: Optional[str] = None\n    last_name: Optional[str] = None\n    phone: Optional[str] = None\n",
      "dependencias": "",
      "tecnologias": "pydantic, fastapi",
      "linea_inicio": 42,
      "numero_lineas": 6,
      "complejidad": 14,
      "imports": "datetime, typing, fastapi_users, pydantic",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "class",
      "ruta": "app\\schemas.py",
      "nombre_archivo": "schemas.py",
      "elemento": "UserUpdate",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase UserUpdate (hereda: schemas.BaseUserUpdate)",
      "summary": "Schema para actualizar usuarios",
      "description": "Schema para actualizar usuarios | 6 atributos",
      "tags": "schemas.BaseUserUpdate",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "username, first_name, last_name, phone, avatar_url, bio",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"username\": \"Optional[str]\", \"first_name\": \"Optional[str]\", \"last_name\": \"Optional[str]\", \"phone\": \"Optional[str]\", \"avatar_url\": \"Optional[str]\", \"bio\": \"Optional[str]\"}",
      "codigo_limpio": "class UserUpdate(schemas.BaseUserUpdate):\n    \"\"\"Schema para actualizar usuarios\"\"\"\n    username: Optional[str] = None\n    first_name: Optional[str] = None\n    last_name: Optional[str] = None\n    phone: Optional[str] = None\n    avatar_url: Optional[str] = None\n    bio: Optional[str] = None\n",
      "dependencias": "",
      "tecnologias": "pydantic, fastapi",
      "linea_inicio": 50,
      "numero_lineas": 8,
      "complejidad": 14,
      "imports": "datetime, typing, fastapi_users, pydantic",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "class",
      "ruta": "app\\schemas.py",
      "nombre_archivo": "schemas.py",
      "elemento": "RoleCreate",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase RoleCreate (hereda: BaseModel)",
      "summary": "Schema para crear rol",
      "description": "Schema para crear rol | 2 atributos",
      "tags": "BaseModel",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "name, description",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"name\": \"str\", \"description\": \"Optional[str]\"}",
      "codigo_limpio": "class RoleCreate(BaseModel):\n    \"\"\"Schema para crear rol\"\"\"\n    name: str\n    description: Optional[str] = None\n",
      "dependencias": "",
      "tecnologias": "pydantic, fastapi",
      "linea_inicio": 60,
      "numero_lineas": 4,
      "complejidad": 14,
      "imports": "datetime, typing, fastapi_users, pydantic",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "class",
      "ruta": "app\\schemas.py",
      "nombre_archivo": "schemas.py",
      "elemento": "RoleRead",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase RoleRead (hereda: BaseModel)",
      "summary": "Schema para leer rol",
      "description": "Schema para leer rol | 3 atributos",
      "tags": "BaseModel",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "id, name, description",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"id\": \"int\", \"name\": \"str\", \"description\": \"Optional[str]\"}",
      "codigo_limpio": "class RoleRead(BaseModel):\n    \"\"\"Schema para leer rol\"\"\"\n    id: int\n    name: str\n    description: Optional[str] = None\n    \n    class Config:\n        from_attributes = True\n",
      "dependencias": "",
      "tecnologias": "pydantic, fastapi",
      "linea_inicio": 66,
      "numero_lineas": 8,
      "complejidad": 14,
      "imports": "datetime, typing, fastapi_users, pydantic",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "class",
      "ruta": "app\\schemas.py",
      "nombre_archivo": "schemas.py",
      "elemento": "UserWithRoles",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase UserWithRoles (hereda: UserRead)",
      "summary": "Usuario con detalles completos de roles",
      "description": "Usuario con detalles completos de roles | 1 atributos | 1 m√©todos",
      "tags": "UserRead",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "roles_detail",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"roles_detail\": \"List[RoleRead]\"}",
      "codigo_limpio": "class UserWithRoles(UserRead):\n    \"\"\"Usuario con detalles completos de roles\"\"\"\n    roles_detail: List[RoleRead] = []\n    \n    @field_validator('roles_detail', mode='before')\n    @classmethod\n    def convert_roles(cls, v):\n        \"\"\"Convierte objetos Role a RoleRead\"\"\"\n        if not v:\n            return []\n        \n        # Si ya son RoleRead, retornar tal cual\n        if isinstance(v, list) and all(isinstance(item, dict) for item in v):\n            return v\n        \n        # Si son objetos Role, convertir\n        try:\n            return [\n                {\n                    'id': role.id,\n                    'name': role.name,\n                    'description': role.description\n                }\n                for role in v\n            ]\n        except (AttributeError, TypeError):\n            return []\n",
      "dependencias": "",
      "tecnologias": "pydantic, fastapi",
      "linea_inicio": 76,
      "numero_lineas": 27,
      "complejidad": 14,
      "imports": "datetime, typing, fastapi_users, pydantic",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "class",
      "ruta": "app\\schemas.py",
      "nombre_archivo": "schemas.py",
      "elemento": "AssignRoleRequest",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase AssignRoleRequest (hereda: BaseModel)",
      "summary": "Request para asignar rol a usuario",
      "description": "Request para asignar rol a usuario | 2 atributos",
      "tags": "BaseModel",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "user_id, role_name",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"user_id\": \"int\", \"role_name\": \"str\"}",
      "codigo_limpio": "class AssignRoleRequest(BaseModel):\n    \"\"\"Request para asignar rol a usuario\"\"\"\n    user_id: int\n    role_name: str\n",
      "dependencias": "",
      "tecnologias": "pydantic, fastapi",
      "linea_inicio": 105,
      "numero_lineas": 4,
      "complejidad": 14,
      "imports": "datetime, typing, fastapi_users, pydantic",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "class",
      "ruta": "app\\schemas.py",
      "nombre_archivo": "schemas.py",
      "elemento": "LoginResponse",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase LoginResponse (hereda: BaseModel)",
      "summary": "Respuesta de login exitoso",
      "description": "Respuesta de login exitoso | 3 atributos",
      "tags": "BaseModel",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "access_token, token_type, user",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"access_token\": \"str\", \"token_type\": \"str\", \"user\": \"UserRead\"}",
      "codigo_limpio": "class LoginResponse(BaseModel):\n    \"\"\"Respuesta de login exitoso\"\"\"\n    access_token: str\n    token_type: str = \"bearer\"\n    user: UserRead\n",
      "dependencias": "",
      "tecnologias": "pydantic, fastapi",
      "linea_inicio": 111,
      "numero_lineas": 5,
      "complejidad": 14,
      "imports": "datetime, typing, fastapi_users, pydantic",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "class",
      "ruta": "app\\schemas.py",
      "nombre_archivo": "schemas.py",
      "elemento": "PaginatedUsers",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase PaginatedUsers (hereda: BaseModel)",
      "summary": "Respuesta paginada de usuarios",
      "description": "Respuesta paginada de usuarios | 5 atributos",
      "tags": "BaseModel",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "items, total, page, size, pages",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"items\": \"List[UserRead]\", \"total\": \"int\", \"page\": \"int\", \"size\": \"int\", \"pages\": \"int\"}",
      "codigo_limpio": "class PaginatedUsers(BaseModel):\n    \"\"\"Respuesta paginada de usuarios\"\"\"\n    items: List[UserRead]\n    total: int\n    page: int\n    size: int\n    pages: int\n",
      "dependencias": "",
      "tecnologias": "pydantic, fastapi",
      "linea_inicio": 118,
      "numero_lineas": 7,
      "complejidad": 14,
      "imports": "datetime, typing, fastapi_users, pydantic",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "class",
      "ruta": "app\\schemas.py",
      "nombre_archivo": "schemas.py",
      "elemento": "ChangePasswordRequest",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase ChangePasswordRequest (hereda: BaseModel)",
      "summary": "Request para cambiar contrase√±a",
      "description": "Request para cambiar contrase√±a | 2 atributos",
      "tags": "BaseModel",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "current_password, new_password",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"current_password\": \"str\", \"new_password\": \"str\"}",
      "codigo_limpio": "class ChangePasswordRequest(BaseModel):\n    \"\"\"Request para cambiar contrase√±a\"\"\"\n    current_password: str\n    new_password: str\n",
      "dependencias": "",
      "tecnologias": "pydantic, fastapi",
      "linea_inicio": 127,
      "numero_lineas": 4,
      "complejidad": 14,
      "imports": "datetime, typing, fastapi_users, pydantic",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "class",
      "ruta": "app\\schemas.py",
      "nombre_archivo": "schemas.py",
      "elemento": "UserSessionRead",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase UserSessionRead (hereda: BaseModel)",
      "summary": "Schema para leer sesi√≥n de usuario",
      "description": "Schema para leer sesi√≥n de usuario | 7 atributos",
      "tags": "BaseModel",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "id, ip_address, user_agent, device_type, created_at, last_activity, is_active",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"id\": \"int\", \"ip_address\": \"Optional[str]\", \"user_agent\": \"Optional[str]\", \"device_type\": \"Optional[str]\", \"created_at\": \"datetime\", \"last_activity\": \"datetime\", \"is_active\": \"bool\"}",
      "codigo_limpio": "class UserSessionRead(BaseModel):\n    \"\"\"Schema para leer sesi√≥n de usuario\"\"\"\n    id: int\n    ip_address: Optional[str]\n    user_agent: Optional[str]\n    device_type: Optional[str]\n    created_at: datetime\n    last_activity: datetime\n    is_active: bool\n    \n    class Config:\n        from_attributes = True\n",
      "dependencias": "",
      "tecnologias": "pydantic, fastapi",
      "linea_inicio": 133,
      "numero_lineas": 12,
      "complejidad": 14,
      "imports": "datetime, typing, fastapi_users, pydantic",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "class",
      "ruta": "app\\schemas.py",
      "nombre_archivo": "schemas.py",
      "elemento": "UserStatsResponse",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase UserStatsResponse (hereda: BaseModel)",
      "summary": "Estad√≠sticas de usuario",
      "description": "Estad√≠sticas de usuario | 4 atributos",
      "tags": "BaseModel",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "total_users, verified_users, active_sessions, users_by_role",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"total_users\": \"int\", \"verified_users\": \"int\", \"active_sessions\": \"int\", \"users_by_role\": \"dict\"}",
      "codigo_limpio": "class UserStatsResponse(BaseModel):\n    \"\"\"Estad√≠sticas de usuario\"\"\"\n    total_users: int\n    verified_users: int\n    active_sessions: int\n    users_by_role: dict\n",
      "dependencias": "",
      "tecnologias": "pydantic, fastapi",
      "linea_inicio": 147,
      "numero_lineas": 6,
      "complejidad": 14,
      "imports": "datetime, typing, fastapi_users, pydantic",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "class",
      "ruta": "app\\schemas.py",
      "nombre_archivo": "schemas.py",
      "elemento": "HealthCheck",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase HealthCheck (hereda: BaseModel)",
      "summary": "Health check response",
      "description": "Health check response | 4 atributos",
      "tags": "BaseModel",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "status, version, database, redis",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"status\": \"str\", \"version\": \"str\", \"database\": \"str\", \"redis\": \"str\"}",
      "codigo_limpio": "class HealthCheck(BaseModel):\n    \"\"\"Health check response\"\"\"\n    status: str\n    version: str\n    database: str\n    redis: str",
      "dependencias": "",
      "tecnologias": "pydantic, fastapi",
      "linea_inicio": 155,
      "numero_lineas": 6,
      "complejidad": 14,
      "imports": "datetime, typing, fastapi_users, pydantic",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "class",
      "ruta": "app\\schemas.py",
      "nombre_archivo": "schemas.py",
      "elemento": "Config",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase Config",
      "summary": "",
      "description": "1 atributos",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "from_attributes",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "    class Config:\n        from_attributes = True\n",
      "dependencias": "",
      "tecnologias": "pydantic, fastapi",
      "linea_inicio": 38,
      "numero_lineas": 2,
      "complejidad": 14,
      "imports": "datetime, typing, fastapi_users, pydantic",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "class",
      "ruta": "app\\schemas.py",
      "nombre_archivo": "schemas.py",
      "elemento": "Config",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase Config",
      "summary": "",
      "description": "1 atributos",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "from_attributes",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "    class Config:\n        from_attributes = True\n",
      "dependencias": "",
      "tecnologias": "pydantic, fastapi",
      "linea_inicio": 72,
      "numero_lineas": 2,
      "complejidad": 14,
      "imports": "datetime, typing, fastapi_users, pydantic",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "class",
      "ruta": "app\\schemas.py",
      "nombre_archivo": "schemas.py",
      "elemento": "Config",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase Config",
      "summary": "",
      "description": "1 atributos",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "from_attributes",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "    class Config:\n        from_attributes = True\n",
      "dependencias": "",
      "tecnologias": "pydantic, fastapi",
      "linea_inicio": 143,
      "numero_lineas": 2,
      "complejidad": 14,
      "imports": "datetime, typing, fastapi_users, pydantic",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "class",
      "ruta": "app\\users_manager.py",
      "nombre_archivo": "users_manager.py",
      "elemento": "Argon2PasswordHelper",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase Argon2PasswordHelper (hereda: PasswordHelperProtocol)",
      "summary": "Password helper personalizado usando Argon2 en lugar de bcrypt",
      "description": "Password helper personalizado usando Argon2 en lugar de bcrypt | 3 m√©todos",
      "tags": "PasswordHelperProtocol",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "class Argon2PasswordHelper(PasswordHelperProtocol):\n    \"\"\"\n    Password helper personalizado usando Argon2 en lugar de bcrypt\n    \"\"\"\n    def __init__(self):\n        self.context = CryptContext(\n            schemes=[\"argon2\"],  # Solo argon2\n            deprecated=\"auto\",\n        )\n    \n    def hash(self, password: str) -> str:\n        \"\"\"Hash password con argon2\"\"\"\n        return self.context.hash(password)\n    \n    def verify_and_update(\n        self, plain_password: str, hashed_password: str\n    ) -> tuple[bool, str | None]:\n        \"\"\"Verifica password y retorna si necesita rehash\"\"\"\n        valid = self.context.verify(plain_password, hashed_password)\n        updated_password = None\n        \n        if valid and self.context.needs_update(hashed_password):\n            updated_password = self.hash(plain_password)\n        \n        return valid, updated_password\n",
      "dependencias": "",
      "tecnologias": "fastapi",
      "linea_inicio": 14,
      "numero_lineas": 25,
      "complejidad": 15,
      "imports": "datetime, typing, fastapi, fastapi_users, fastapi_users.password, passlib.context, app.models, app.config, app.email",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "class",
      "ruta": "app\\users_manager.py",
      "nombre_archivo": "users_manager.py",
      "elemento": "UserManager",
      "categoria": "CLASS",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Clase UserManager (hereda: IntegerIDMixin, BaseUserManager[User, int])",
      "summary": "Manager personalizado para FastAPI Users\nManeja eventos de registro, verificaci√≥n, cambio de contras",
      "description": "Manager personalizado para FastAPI Users\nManeja eventos de registro, verificaci√≥n, cambio de contrase√±a, etc. | 2 atributos | 9 m√©todos",
      "tags": "IntegerIDMixin, BaseUserManager[User, int]",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "reset_password_token_secret, verification_token_secret",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "class UserManager(IntegerIDMixin, BaseUserManager[User, int]):\n    \"\"\"\n    Manager personalizado para FastAPI Users\n    Maneja eventos de registro, verificaci√≥n, cambio de contrase√±a, etc.\n    \"\"\"\n    \n    reset_password_token_secret = settings.secret_key\n    verification_token_secret = settings.secret_key\n    \n    def __init__(self, user_db):\n        \"\"\"Inicializar con password helper personalizado\"\"\"\n        super().__init__(user_db)\n        # CR√çTICO: Reemplazar el password_helper por defecto\n        self.password_helper = Argon2PasswordHelper()\n    \n    async def on_after_register(self, user: User, request: Optional[Request] = None):\n        \"\"\"Se ejecuta despu√©s de registrar un usuario\"\"\"\n        print(f\"‚úÖ Usuario registrado: {user.email}\")\n        \n        if settings.mail_username:\n            try:\n                token = await self.request_verify(user, request)\n                await send_verification_email(user.email, token)\n            except Exception as e:\n                print(f\"‚ùå Error enviando email de verificaci√≥n: {e}\")\n    \n    async def on_after_forgot_password(\n        self, user: User, token: str, request: Optional[Request] = None\n    ):\n        \"\"\"Se ejecuta cuando se solicita reset de contrase√±a\"\"\"\n        print(f\"üîë Reset de contrase√±a solicitado para: {user.email}\")\n        \n        if settings.mail_username:\n            try:\n                await send_password_reset_email(user.email, token)\n            except Exception as e:\n                print(f\"‚ùå Error enviando email de reset: {e}\")\n    \n    async def on_after_request_verify(\n        self, user: User, token: str, request: Optional[Request] = None\n    ):\n        \"\"\"Se ejecuta cuando se solicita verificaci√≥n de email\"\"\"\n        print(f\"üìß Verificaci√≥n solicitada para: {user.email}\")\n    \n    async def on_after_verify(\n        self, user: User, request: Optional[Request] = None\n    ):\n        \"\"\"Se ejecuta despu√©s de verificar email\"\"\"\n        print(f\"‚úÖ Email verificado: {user.email}\")\n    \n \n... (truncado)",
      "dependencias": "",
      "tecnologias": "fastapi",
      "linea_inicio": 41,
      "numero_lineas": 102,
      "complejidad": 15,
      "imports": "datetime, typing, fastapi, fastapi_users, fastapi_users.password, passlib.context, app.models, app.config, app.email",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "getter",
      "ruta": "app\\users_manager.py",
      "nombre_archivo": "users_manager.py",
      "elemento": "get_user_manager",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n get_user_manager(user_db)",
      "summary": "Dependency para obtener el UserManager",
      "description": "Dependency para obtener el UserManager | Tipo: getter | Complejidad: 1",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "",
      "parametros": "user_db",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "async def get_user_manager(user_db=Depends(get_user_db)):\n    \"\"\"Dependency para obtener el UserManager\"\"\"\n    yield UserManager(user_db)",
      "dependencias": "",
      "tecnologias": "fastapi",
      "linea_inicio": 145,
      "numero_lineas": 3,
      "complejidad": 1,
      "imports": "datetime, typing, fastapi, fastapi_users, fastapi_users.password, passlib.context, app.models, app.config, app.email",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\admin.py",
      "nombre_archivo": "admin.py",
      "elemento": "endpoint_function_14",
      "categoria": "ENDPOINT",
      "endpoint": "/stats",
      "metodo_http": "GET",
      "descripcion": "GET /stats",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "UserStatsResponse",
      "status_code": "",
      "decoradores": "@router.get(\"/stats\", response_model=UserStatsResponse)",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "@router.get(\"/stats\", response_model=UserStatsResponse)",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 15,
      "numero_lineas": 1,
      "complejidad": 17,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, datetime, app.models, app.auth, app.schemas",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\admin.py",
      "nombre_archivo": "admin.py",
      "elemento": "endpoint_function_65",
      "categoria": "ENDPOINT",
      "endpoint": "/users/search",
      "metodo_http": "GET",
      "descripcion": "GET /users/search",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "PaginatedUsers",
      "status_code": "",
      "decoradores": "@router.get(\"/users/search\", response_model=PaginatedUsers)",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "@router.get(\"/users/search\", response_model=PaginatedUsers)",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 66,
      "numero_lineas": 1,
      "complejidad": 17,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, datetime, app.models, app.auth, app.schemas",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\admin.py",
      "nombre_archivo": "admin.py",
      "elemento": "endpoint_function_139",
      "categoria": "ENDPOINT",
      "endpoint": "/users/{user_id}/activate",
      "metodo_http": "POST",
      "descripcion": "POST /users/{user_id}/activate",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "@router.post(\"/users/{user_id}/activate\")",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "@router.post(\"/users/{user_id}/activate\")",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 140,
      "numero_lineas": 1,
      "complejidad": 17,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, datetime, app.models, app.auth, app.schemas",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\admin.py",
      "nombre_archivo": "admin.py",
      "elemento": "endpoint_function_165",
      "categoria": "ENDPOINT",
      "endpoint": "/users/{user_id}/deactivate",
      "metodo_http": "POST",
      "descripcion": "POST /users/{user_id}/deactivate",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "@router.post(\"/users/{user_id}/deactivate\")",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "@router.post(\"/users/{user_id}/deactivate\")",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 166,
      "numero_lineas": 1,
      "complejidad": 17,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, datetime, app.models, app.auth, app.schemas",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\admin.py",
      "nombre_archivo": "admin.py",
      "elemento": "endpoint_function_195",
      "categoria": "ENDPOINT",
      "endpoint": "/users/{user_id}/verify",
      "metodo_http": "POST",
      "descripcion": "POST /users/{user_id}/verify",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "@router.post(\"/users/{user_id}/verify\")",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "@router.post(\"/users/{user_id}/verify\")",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 196,
      "numero_lineas": 1,
      "complejidad": 17,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, datetime, app.models, app.auth, app.schemas",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\admin.py",
      "nombre_archivo": "admin.py",
      "elemento": "endpoint_function_219",
      "categoria": "ENDPOINT",
      "endpoint": "/users/{user_id}",
      "metodo_http": "DELETE",
      "descripcion": "DELETE /users/{user_id}",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "@router.delete(\"/users/{user_id}\")",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "@router.delete(\"/users/{user_id}\")",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 220,
      "numero_lineas": 1,
      "complejidad": 17,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, datetime, app.models, app.auth, app.schemas",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\admin.py",
      "nombre_archivo": "admin.py",
      "elemento": "endpoint_function_249",
      "categoria": "ENDPOINT",
      "endpoint": "/users/{user_id}/make-superuser",
      "metodo_http": "POST",
      "descripcion": "POST /users/{user_id}/make-superuser",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "@router.post(\"/users/{user_id}/make-superuser\")",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "@router.post(\"/users/{user_id}/make-superuser\")",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 250,
      "numero_lineas": 1,
      "complejidad": 17,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, datetime, app.models, app.auth, app.schemas",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\admin.py",
      "nombre_archivo": "admin.py",
      "elemento": "endpoint_function_283",
      "categoria": "ENDPOINT",
      "endpoint": "/sessions/active",
      "metodo_http": "GET",
      "descripcion": "GET /sessions/active",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "@router.get(\"/sessions/active\")",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "@router.get(\"/sessions/active\")",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 284,
      "numero_lineas": 1,
      "complejidad": 17,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, datetime, app.models, app.auth, app.schemas",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\admin.py",
      "nombre_archivo": "admin.py",
      "elemento": "endpoint_function_311",
      "categoria": "ENDPOINT",
      "endpoint": "/sessions/cleanup",
      "metodo_http": "DELETE",
      "descripcion": "DELETE /sessions/cleanup",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "@router.delete(\"/sessions/cleanup\")",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "@router.delete(\"/sessions/cleanup\")",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 312,
      "numero_lineas": 1,
      "complejidad": 17,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, datetime, app.models, app.auth, app.schemas",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "getter",
      "ruta": "app\\routers\\admin.py",
      "nombre_archivo": "admin.py",
      "elemento": "get_user_statistics",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n get_user_statistics(session: AsyncSession, current_user: User)",
      "summary": "Obtiene estad√≠sticas generales del sistema (solo admin)",
      "description": "Obtiene estad√≠sticas generales del sistema (solo admin) | Tipo: getter | Complejidad: 2",
      "tags": "router.get('/stats', response_model=UserStatsResponse)",
      "response_model": "",
      "status_code": "",
      "decoradores": "router.get('/stats', response_model=UserStatsResponse)",
      "parametros": "session, current_user",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"session\": \"AsyncSession\", \"current_user\": \"User\"}",
      "codigo_limpio": "async def get_user_statistics(\n    session: AsyncSession = Depends(get_async_session),\n    current_user: User = Depends(admin_required)\n):\n    \"\"\"\n    Obtiene estad√≠sticas generales del sistema (solo admin)\n    \"\"\"\n    # Total de usuarios\n    total_users_result = await session.execute(\n        select(func.count(User.id))\n    )\n    total_users = total_users_result.scalar()\n    \n    # Usuarios verificados\n    verified_users_result = await session.execute(\n        select(func.count(User.id)).where(User.is_verified == True)\n    )\n    verified_users = verified_users_result.scalar()\n    \n    # Sesiones activas\n    active_sessions_result = await session.execute(\n        select(func.count(UserSession.id)).where(UserSession.is_active == True)\n    )\n    active_sessions = active_sessions_result.scalar()\n    \n    # Usuarios por rol\n    roles_result = await session.execute(select(Role))\n    roles = roles_result.scalars().all()\n    \n    users_by_role = {}\n    for role in roles:\n        count_result = await session.execute(\n            select(func.count(User.id))\n            .join(User.roles)\n            .where(Role.id == role.id)\n        )\n        users_by_role[role.name] = count_result.scalar()\n    \n    return UserStatsResponse(\n        total_users=total_users,\n        verified_users=verified_users,\n        active_sessions=active_sessions,\n        users_by_role=users_by_role\n    )\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 16,
      "numero_lineas": 44,
      "complejidad": 2,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, datetime, app.models, app.auth, app.schemas",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\routers\\admin.py",
      "nombre_archivo": "admin.py",
      "elemento": "search_users",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n search_users(session: AsyncSession, current_user: User, q: str)",
      "summary": "B√∫squeda avanzada de usuarios (solo admin)",
      "description": "B√∫squeda avanzada de usuarios (solo admin) | Tipo: function | Complejidad: 4",
      "tags": "router.get('/users/search', response_model=PaginatedUsers)",
      "response_model": "",
      "status_code": "",
      "decoradores": "router.get('/users/search', response_model=PaginatedUsers)",
      "parametros": "session, current_user, q, page, size, role, is_verified, is_active",
      "parametros_query": "q, page, size, role, is_verified, is_active",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"session\": \"AsyncSession\", \"current_user\": \"User\", \"q\": \"str\", \"page\": \"int\", \"size\": \"int\", \"role\": \"str\", \"is_verified\": \"bool\", \"is_active\": \"bool\"}",
      "codigo_limpio": "async def search_users(\n    session: AsyncSession = Depends(get_async_session),\n    current_user: User = Depends(admin_required),\n    q: str = Query(None, description=\"Search query\"),\n    page: int = Query(1, gt=0),\n    size: int = Query(10, gt=0, le=100),\n    role: str = Query(None, description=\"Filter by role\"),\n    is_verified: bool = Query(None, description=\"Filter by verification status\"),\n    is_active: bool = Query(None, description=\"Filter by active status\")\n):\n    \"\"\"\n    B√∫squeda avanzada de usuarios (solo admin)\n    \"\"\"\n    query = select(User)\n    \n    # Filtros\n    if q:\n        query = query.where(\n            (User.username.ilike(f\"%{q}%\")) |\n            (User.email.ilike(f\"%{q}%\")) |\n            (User.first_name.ilike(f\"%{q}%\")) |\n            (User.last_name.ilike(f\"%{q}%\"))\n        )\n    \n    if is_verified is not None:\n        query = query.where(User.is_verified == is_verified)\n    \n    if is_active is not None:\n        query = query.where(User.is_active == is_active)\n    \n    # Contar total\n    count_query = select(func.count()).select_from(query.subquery())\n    total_result = await session.execute(count_query)\n    total = total_result.scalar()\n    \n    # Paginaci√≥n\n    query = query.offset((page - 1) * size).limit(size)\n    result = await session.execute(query)\n    users = result.scalars().all()\n    \n    pages = (total + size - 1) // size\n    \n    return PaginatedUsers(\n        items=[\n            UserRead(\n                id=user.id,\n                email=user.email,\n                username=user.username,\n                first_name=user.first_name,\n                last_name=user.last_name,\n                phone=user.phone,\n                avatar_url=user.avatar_url,\n                bio=user.bio,\n                is_active=user.is_active,\n                is_superuser=user.is_superuser,\n                is_verified=user.is_verified,\n                created_at=user.created_at,\n                last_login=user.last_login,\n                roles=[role.\n... (truncado)",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 67,
      "numero_lineas": 67,
      "complejidad": 4,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, datetime, app.models, app.auth, app.schemas",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\routers\\admin.py",
      "nombre_archivo": "admin.py",
      "elemento": "activate_user",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n activate_user(user_id: int, session: AsyncSession, current_user: User)",
      "summary": "Activa un usuario (solo admin)",
      "description": "Activa un usuario (solo admin) | Tipo: function | Complejidad: 2",
      "tags": "router.post('/users/{user_id}/activate')",
      "response_model": "",
      "status_code": "",
      "decoradores": "router.post('/users/{user_id}/activate')",
      "parametros": "user_id, session, current_user",
      "parametros_query": "user_id",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"user_id\": \"int\", \"session\": \"AsyncSession\", \"current_user\": \"User\"}",
      "codigo_limpio": "async def activate_user(\n    user_id: int,\n    session: AsyncSession = Depends(get_async_session),\n    current_user: User = Depends(admin_required)\n):\n    \"\"\"Activa un usuario (solo admin)\"\"\"\n    result = await session.execute(\n        select(User).where(User.id == user_id)\n    )\n    user = result.scalar_one_or_none()\n    \n    if not user:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"User not found\"\n        )\n    \n    user.is_active = True\n    user.locked_until = None\n    user.failed_login_attempts = 0\n    await session.commit()\n    \n    return {\"message\": f\"User {user.username} activated successfully\"}\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 141,
      "numero_lineas": 23,
      "complejidad": 2,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, datetime, app.models, app.auth, app.schemas",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\routers\\admin.py",
      "nombre_archivo": "admin.py",
      "elemento": "deactivate_user",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n deactivate_user(user_id: int, session: AsyncSession, current_user: User)",
      "summary": "Desactiva un usuario (solo admin)",
      "description": "Desactiva un usuario (solo admin) | Tipo: function | Complejidad: 3",
      "tags": "router.post('/users/{user_id}/deactivate')",
      "response_model": "",
      "status_code": "",
      "decoradores": "router.post('/users/{user_id}/deactivate')",
      "parametros": "user_id, session, current_user",
      "parametros_query": "user_id",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"user_id\": \"int\", \"session\": \"AsyncSession\", \"current_user\": \"User\"}",
      "codigo_limpio": "async def deactivate_user(\n    user_id: int,\n    session: AsyncSession = Depends(get_async_session),\n    current_user: User = Depends(admin_required)\n):\n    \"\"\"Desactiva un usuario (solo admin)\"\"\"\n    result = await session.execute(\n        select(User).where(User.id == user_id)\n    )\n    user = result.scalar_one_or_none()\n    \n    if not user:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"User not found\"\n        )\n    \n    if user.is_superuser:\n        raise HTTPException(\n            status_code=status.HTTP_400_BAD_REQUEST,\n            detail=\"Cannot deactivate superuser\"\n        )\n    \n    user.is_active = False\n    await session.commit()\n    \n    return {\"message\": f\"User {user.username} deactivated successfully\"}\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 167,
      "numero_lineas": 27,
      "complejidad": 3,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, datetime, app.models, app.auth, app.schemas",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "validator",
      "ruta": "app\\routers\\admin.py",
      "nombre_archivo": "admin.py",
      "elemento": "verify_user_manually",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n verify_user_manually(user_id: int, session: AsyncSession, current_user: User)",
      "summary": "Verifica manualmente un usuario (solo admin)",
      "description": "Verifica manualmente un usuario (solo admin) | Tipo: validator | Complejidad: 2",
      "tags": "router.post('/users/{user_id}/verify')",
      "response_model": "",
      "status_code": "",
      "decoradores": "router.post('/users/{user_id}/verify')",
      "parametros": "user_id, session, current_user",
      "parametros_query": "user_id",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"user_id\": \"int\", \"session\": \"AsyncSession\", \"current_user\": \"User\"}",
      "codigo_limpio": "async def verify_user_manually(\n    user_id: int,\n    session: AsyncSession = Depends(get_async_session),\n    current_user: User = Depends(admin_required)\n):\n    \"\"\"Verifica manualmente un usuario (solo admin)\"\"\"\n    result = await session.execute(\n        select(User).where(User.id == user_id)\n    )\n    user = result.scalar_one_or_none()\n    \n    if not user:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"User not found\"\n        )\n    \n    user.is_verified = True\n    await session.commit()\n    \n    return {\"message\": f\"User {user.username} verified successfully\"}\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 197,
      "numero_lineas": 21,
      "complejidad": 2,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, datetime, app.models, app.auth, app.schemas",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\routers\\admin.py",
      "nombre_archivo": "admin.py",
      "elemento": "delete_user",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n delete_user(user_id: int, session: AsyncSession, current_user: User)",
      "summary": "Elimina un usuario permanentemente (solo admin)",
      "description": "Elimina un usuario permanentemente (solo admin) | Tipo: function | Complejidad: 3",
      "tags": "router.delete('/users/{user_id}')",
      "response_model": "",
      "status_code": "",
      "decoradores": "router.delete('/users/{user_id}')",
      "parametros": "user_id, session, current_user",
      "parametros_query": "user_id",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"user_id\": \"int\", \"session\": \"AsyncSession\", \"current_user\": \"User\"}",
      "codigo_limpio": "async def delete_user(\n    user_id: int,\n    session: AsyncSession = Depends(get_async_session),\n    current_user: User = Depends(admin_required)\n):\n    \"\"\"Elimina un usuario permanentemente (solo admin)\"\"\"\n    result = await session.execute(\n        select(User).where(User.id == user_id)\n    )\n    user = result.scalar_one_or_none()\n    \n    if not user:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"User not found\"\n        )\n    \n    if user.is_superuser:\n        raise HTTPException(\n            status_code=status.HTTP_400_BAD_REQUEST,\n            detail=\"Cannot delete superuser\"\n        )\n    \n    await session.delete(user)\n    await session.commit()\n    \n    return {\"message\": f\"User {user.username} deleted successfully\"}\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 221,
      "numero_lineas": 27,
      "complejidad": 3,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, datetime, app.models, app.auth, app.schemas",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "factory",
      "ruta": "app\\routers\\admin.py",
      "nombre_archivo": "admin.py",
      "elemento": "make_superuser",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n make_superuser(user_id: int, session: AsyncSession, current_user: User)",
      "summary": "Convierte un usuario en superuser (solo admin)",
      "description": "Convierte un usuario en superuser (solo admin) | Tipo: factory | Complejidad: 3",
      "tags": "router.post('/users/{user_id}/make-superuser')",
      "response_model": "",
      "status_code": "",
      "decoradores": "router.post('/users/{user_id}/make-superuser')",
      "parametros": "user_id, session, current_user",
      "parametros_query": "user_id",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"user_id\": \"int\", \"session\": \"AsyncSession\", \"current_user\": \"User\"}",
      "codigo_limpio": "async def make_superuser(\n    user_id: int,\n    session: AsyncSession = Depends(get_async_session),\n    current_user: User = Depends(admin_required)\n):\n    \"\"\"Convierte un usuario en superuser (solo admin)\"\"\"\n    if not current_user.is_superuser:\n        raise HTTPException(\n            status_code=status.HTTP_403_FORBIDDEN,\n            detail=\"Only superusers can create other superusers\"\n        )\n    \n    result = await session.execute(\n        select(User).where(User.id == user_id)\n    )\n    user = result.scalar_one_or_none()\n    \n    if not user:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"User not found\"\n        )\n    \n    user.is_superuser = True\n    await session.commit()\n    \n    return {\"message\": f\"User {user.username} is now a superuser\"}\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 251,
      "numero_lineas": 27,
      "complejidad": 3,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, datetime, app.models, app.auth, app.schemas",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "getter",
      "ruta": "app\\routers\\admin.py",
      "nombre_archivo": "admin.py",
      "elemento": "get_active_sessions",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n get_active_sessions(session: AsyncSession, current_user: User, limit: int)",
      "summary": "Obtiene las sesiones activas del sistema (solo admin)",
      "description": "Obtiene las sesiones activas del sistema (solo admin) | Tipo: getter | Complejidad: 1",
      "tags": "router.get('/sessions/active')",
      "response_model": "",
      "status_code": "",
      "decoradores": "router.get('/sessions/active')",
      "parametros": "session, current_user, limit",
      "parametros_query": "limit",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"session\": \"AsyncSession\", \"current_user\": \"User\", \"limit\": \"int\"}",
      "codigo_limpio": "async def get_active_sessions(\n    session: AsyncSession = Depends(get_async_session),\n    current_user: User = Depends(admin_required),\n    limit: int = 50\n):\n    \"\"\"Obtiene las sesiones activas del sistema (solo admin)\"\"\"\n    result = await session.execute(\n        select(UserSession)\n        .where(UserSession.is_active == True)\n        .order_by(UserSession.last_activity.desc())\n        .limit(limit)\n    )\n    sessions = result.scalars().all()\n    \n    return [\n        {\n            \"id\": s.id,\n            \"user_id\": s.user_id,\n            \"ip_address\": s.ip_address,\n            \"device_type\": s.device_type,\n            \"created_at\": s.created_at,\n            \"last_activity\": s.last_activity\n        }\n        for s in sessions\n    ]\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 285,
      "numero_lineas": 25,
      "complejidad": 1,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, datetime, app.models, app.auth, app.schemas",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\routers\\admin.py",
      "nombre_archivo": "admin.py",
      "elemento": "cleanup_expired_sessions",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n cleanup_expired_sessions(session: AsyncSession, current_user: User)",
      "summary": "Limpia sesiones expiradas (solo admin)",
      "description": "Limpia sesiones expiradas (solo admin) | Tipo: function | Complejidad: 2",
      "tags": "router.delete('/sessions/cleanup')",
      "response_model": "",
      "status_code": "",
      "decoradores": "router.delete('/sessions/cleanup')",
      "parametros": "session, current_user",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"session\": \"AsyncSession\", \"current_user\": \"User\"}",
      "codigo_limpio": "async def cleanup_expired_sessions(\n    session: AsyncSession = Depends(get_async_session),\n    current_user: User = Depends(admin_required)\n):\n    \"\"\"Limpia sesiones expiradas (solo admin)\"\"\"\n    now = datetime.utcnow()\n    \n    result = await session.execute(\n        select(UserSession).where(\n            and_(\n                UserSession.expires_at < now,\n                UserSession.is_active == True\n            )\n        )\n    )\n    expired_sessions = result.scalars().all()\n    \n    count = 0\n    for sess in expired_sessions:\n        sess.is_active = False\n        sess.revoked_at = now\n        count += 1\n    \n    await session.commit()\n    \n    return {\"message\": f\"Cleaned up {count} expired sessions\"}",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 313,
      "numero_lineas": 26,
      "complejidad": 2,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, datetime, app.models, app.auth, app.schemas",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\health.py",
      "nombre_archivo": "health.py",
      "elemento": "endpoint_function_9",
      "categoria": "ENDPOINT",
      "endpoint": "/",
      "metodo_http": "GET",
      "descripcion": "GET /",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "HealthCheck",
      "status_code": "",
      "decoradores": "@router.get(\"/\", response_model=HealthCheck)",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "@router.get(\"/\", response_model=HealthCheck)",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 10,
      "numero_lineas": 1,
      "complejidad": 4,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, app.models, app.schemas",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\health.py",
      "nombre_archivo": "health.py",
      "elemento": "ping",
      "categoria": "ENDPOINT",
      "endpoint": "/ping",
      "metodo_http": "GET",
      "descripcion": "GET /ping",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "@router.get(\"/ping\")",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "async def ping():\n    \"\"\"Simple ping endpoint\"\"\"\n    return {\"ping\": \"pong\"}",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 36,
      "numero_lineas": 3,
      "complejidad": 4,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, app.models, app.schemas",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\routers\\health.py",
      "nombre_archivo": "health.py",
      "elemento": "health_check",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n health_check(session: AsyncSession)",
      "summary": "Verifica el estado de salud del servicio",
      "description": "Verifica el estado de salud del servicio | Tipo: function | Complejidad: 2",
      "tags": "router.get('/', response_model=HealthCheck)",
      "response_model": "",
      "status_code": "",
      "decoradores": "router.get('/', response_model=HealthCheck)",
      "parametros": "session",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"session\": \"AsyncSession\"}",
      "codigo_limpio": "async def health_check(\n    session: AsyncSession = Depends(get_async_session)\n):\n    \"\"\"\n    Verifica el estado de salud del servicio\n    \"\"\"\n    # Verificar base de datos\n    try:\n        await session.execute(text(\"SELECT 1\"))\n        db_status = \"healthy\"\n    except Exception as e:\n        db_status = f\"unhealthy: {str(e)}\"\n    \n    # Verificar Redis (si est√° configurado)\n    redis_status = \"not configured\"\n    # Aqu√≠ puedes agregar verificaci√≥n de Redis si lo usas\n    \n    return HealthCheck(\n        status=\"healthy\" if db_status == \"healthy\" else \"unhealthy\",\n        version=\"2.0.0\",\n        database=db_status,\n        redis=redis_status\n    )\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 11,
      "numero_lineas": 23,
      "complejidad": 2,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, app.models, app.schemas",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\roles.py",
      "nombre_archivo": "roles.py",
      "elemento": "endpoint_function_10",
      "categoria": "ENDPOINT",
      "endpoint": "/",
      "metodo_http": "GET",
      "descripcion": "GET /",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "List[RoleRead]",
      "status_code": "",
      "decoradores": "@router.get(\"/\", response_model=List[RoleRead])",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "@router.get(\"/\", response_model=List[RoleRead])",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 11,
      "numero_lineas": 1,
      "complejidad": 12,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, typing, app.models, app.auth, app.schemas",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\roles.py",
      "nombre_archivo": "roles.py",
      "elemento": "endpoint_function_21",
      "categoria": "ENDPOINT",
      "endpoint": "/",
      "metodo_http": "POST",
      "descripcion": "POST /",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "RoleRead",
      "status_code": "201",
      "decoradores": "@router.post(\"/\", response_model=RoleRead, status_code=status.HTTP_201_CREATED)",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "@router.post(\"/\", response_model=RoleRead, status_code=status.HTTP_201_CREATED)",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 22,
      "numero_lineas": 1,
      "complejidad": 12,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, typing, app.models, app.auth, app.schemas",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\roles.py",
      "nombre_archivo": "roles.py",
      "elemento": "endpoint_function_51",
      "categoria": "ENDPOINT",
      "endpoint": "/{role_id}",
      "metodo_http": "DELETE",
      "descripcion": "DELETE /{role_id}",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "@router.delete(\"/{role_id}\")",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "@router.delete(\"/{role_id}\")",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 52,
      "numero_lineas": 1,
      "complejidad": 12,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, typing, app.models, app.auth, app.schemas",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\roles.py",
      "nombre_archivo": "roles.py",
      "elemento": "endpoint_function_82",
      "categoria": "ENDPOINT",
      "endpoint": "/assign",
      "metodo_http": "POST",
      "descripcion": "POST /assign",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "@router.post(\"/assign\")",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "@router.post(\"/assign\")",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 83,
      "numero_lineas": 1,
      "complejidad": 12,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, typing, app.models, app.auth, app.schemas",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\roles.py",
      "nombre_archivo": "roles.py",
      "elemento": "endpoint_function_132",
      "categoria": "ENDPOINT",
      "endpoint": "/revoke",
      "metodo_http": "DELETE",
      "descripcion": "DELETE /revoke",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "@router.delete(\"/revoke\")",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "@router.delete(\"/revoke\")",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 133,
      "numero_lineas": 1,
      "complejidad": 12,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, typing, app.models, app.auth, app.schemas",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "getter",
      "ruta": "app\\routers\\roles.py",
      "nombre_archivo": "roles.py",
      "elemento": "get_all_roles",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n get_all_roles(session: AsyncSession, current_user: User)",
      "summary": "Obtiene todos los roles disponibles (solo admin)",
      "description": "Obtiene todos los roles disponibles (solo admin) | Tipo: getter | Complejidad: 1",
      "tags": "router.get('/', response_model=List[RoleRead])",
      "response_model": "",
      "status_code": "",
      "decoradores": "router.get('/', response_model=List[RoleRead])",
      "parametros": "session, current_user",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"session\": \"AsyncSession\", \"current_user\": \"User\"}",
      "codigo_limpio": "async def get_all_roles(\n    session: AsyncSession = Depends(get_async_session),\n    current_user: User = Depends(admin_required)\n):\n    \"\"\"Obtiene todos los roles disponibles (solo admin)\"\"\"\n    result = await session.execute(select(Role))\n    roles = result.scalars().all()\n    return roles\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 12,
      "numero_lineas": 8,
      "complejidad": 1,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, typing, app.models, app.auth, app.schemas",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "factory",
      "ruta": "app\\routers\\roles.py",
      "nombre_archivo": "roles.py",
      "elemento": "create_role",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n create_role(role_data: RoleCreate, session: AsyncSession, current_user: User)",
      "summary": "Crea un nuevo rol (solo admin)",
      "description": "Crea un nuevo rol (solo admin) | Tipo: factory | Complejidad: 2",
      "tags": "router.post('/', response_model=RoleRead, status_code=status.HTTP_201_CREATED)",
      "response_model": "",
      "status_code": "",
      "decoradores": "router.post('/', response_model=RoleRead, status_code=status.HTTP_201_CREATED)",
      "parametros": "role_data, session, current_user",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"role_data\": \"RoleCreate\", \"session\": \"AsyncSession\", \"current_user\": \"User\"}",
      "codigo_limpio": "async def create_role(\n    role_data: RoleCreate,\n    session: AsyncSession = Depends(get_async_session),\n    current_user: User = Depends(admin_required)\n):\n    \"\"\"Crea un nuevo rol (solo admin)\"\"\"\n    # Verificar si el rol ya existe\n    result = await session.execute(\n        select(Role).where(Role.name == role_data.name)\n    )\n    existing_role = result.scalar_one_or_none()\n    \n    if existing_role:\n        raise HTTPException(\n            status_code=status.HTTP_400_BAD_REQUEST,\n            detail=f\"Role {role_data.name} already exists\"\n        )\n    \n    new_role = Role(\n        name=role_data.name,\n        description=role_data.description\n    )\n    session.add(new_role)\n    await session.commit()\n    await session.refresh(new_role)\n    \n    return new_role\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 23,
      "numero_lineas": 27,
      "complejidad": 2,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, typing, app.models, app.auth, app.schemas",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\routers\\roles.py",
      "nombre_archivo": "roles.py",
      "elemento": "delete_role",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n delete_role(role_id: int, session: AsyncSession, current_user: User)",
      "summary": "Elimina un rol (solo admin)",
      "description": "Elimina un rol (solo admin) | Tipo: function | Complejidad: 3",
      "tags": "router.delete('/{role_id}')",
      "response_model": "",
      "status_code": "",
      "decoradores": "router.delete('/{role_id}')",
      "parametros": "role_id, session, current_user",
      "parametros_query": "role_id",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"role_id\": \"int\", \"session\": \"AsyncSession\", \"current_user\": \"User\"}",
      "codigo_limpio": "async def delete_role(\n    role_id: int,\n    session: AsyncSession = Depends(get_async_session),\n    current_user: User = Depends(admin_required)\n):\n    \"\"\"Elimina un rol (solo admin)\"\"\"\n    result = await session.execute(\n        select(Role).where(Role.id == role_id)\n    )\n    role = result.scalar_one_or_none()\n    \n    if not role:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"Role not found\"\n        )\n    \n    # No permitir eliminar roles por defecto\n    if role.name in [\"ROLE_USER\", \"ROLE_ADMIN\", \"ROLE_MODERATOR\"]:\n        raise HTTPException(\n            status_code=status.HTTP_400_BAD_REQUEST,\n            detail=\"Cannot delete default roles\"\n        )\n    \n    await session.delete(role)\n    await session.commit()\n    \n    return {\"message\": f\"Role {role.name} deleted successfully\"}\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 53,
      "numero_lineas": 28,
      "complejidad": 3,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, typing, app.models, app.auth, app.schemas",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\routers\\roles.py",
      "nombre_archivo": "roles.py",
      "elemento": "assign_role_to_user",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n assign_role_to_user(request: AssignRoleRequest, session: AsyncSession, current_user: User)",
      "summary": "Asigna un rol a un usuario (solo admin)",
      "description": "Asigna un rol a un usuario (solo admin) | Tipo: function | Complejidad: 4",
      "tags": "router.post('/assign')",
      "response_model": "",
      "status_code": "",
      "decoradores": "router.post('/assign')",
      "parametros": "request, session, current_user",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"request\": \"AssignRoleRequest\", \"session\": \"AsyncSession\", \"current_user\": \"User\"}",
      "codigo_limpio": "async def assign_role_to_user(\n    request: AssignRoleRequest,\n    session: AsyncSession = Depends(get_async_session),\n    current_user: User = Depends(admin_required)\n):\n    \"\"\"Asigna un rol a un usuario (solo admin)\"\"\"\n    # Obtener usuario\n    user_result = await session.execute(\n        select(User).where(User.id == request.user_id)\n    )\n    user = user_result.scalar_one_or_none()\n    \n    if not user:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"User not found\"\n        )\n    \n    # Obtener rol\n    role_result = await session.execute(\n        select(Role).where(Role.name == request.role_name)\n    )\n    role = role_result.scalar_one_or_none()\n    \n    if not role:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"Role not found\"\n        )\n    \n    # Verificar si ya tiene el rol\n    if role in user.roles:\n        raise HTTPException(\n            status_code=status.HTTP_400_BAD_REQUEST,\n            detail=f\"User already has role {request.role_name}\"\n        )\n    \n    # Asignar rol\n    user.roles.append(role)\n    await session.commit()\n    \n    return {\n        \"message\": f\"Role {request.role_name} assigned to user {user.username}\",\n        \"user_id\": user.id,\n        \"username\": user.username,\n        \"roles\": [r.name for r in user.roles]\n    }\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 84,
      "numero_lineas": 47,
      "complejidad": 4,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, typing, app.models, app.auth, app.schemas",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\routers\\roles.py",
      "nombre_archivo": "roles.py",
      "elemento": "revoke_role_from_user",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n revoke_role_from_user(request: AssignRoleRequest, session: AsyncSession, current_user: User)",
      "summary": "Revoca un rol de un usuario (solo admin)",
      "description": "Revoca un rol de un usuario (solo admin) | Tipo: function | Complejidad: 4",
      "tags": "router.delete('/revoke')",
      "response_model": "",
      "status_code": "",
      "decoradores": "router.delete('/revoke')",
      "parametros": "request, session, current_user",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"request\": \"AssignRoleRequest\", \"session\": \"AsyncSession\", \"current_user\": \"User\"}",
      "codigo_limpio": "async def revoke_role_from_user(\n    request: AssignRoleRequest,\n    session: AsyncSession = Depends(get_async_session),\n    current_user: User = Depends(admin_required)\n):\n    \"\"\"Revoca un rol de un usuario (solo admin)\"\"\"\n    # Obtener usuario\n    user_result = await session.execute(\n        select(User).where(User.id == request.user_id)\n    )\n    user = user_result.scalar_one_or_none()\n    \n    if not user:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"User not found\"\n        )\n    \n    # Obtener rol\n    role_result = await session.execute(\n        select(Role).where(Role.name == request.role_name)\n    )\n    role = role_result.scalar_one_or_none()\n    \n    if not role:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"Role not found\"\n        )\n    \n    # Verificar si tiene el rol\n    if role not in user.roles:\n        raise HTTPException(\n            status_code=status.HTTP_400_BAD_REQUEST,\n            detail=f\"User doesn't have role {request.role_name}\"\n        )\n    \n    # Revocar rol\n    user.roles.remove(role)\n    await session.commit()\n    \n    return {\n        \"message\": f\"Role {request.role_name} revoked from user {user.username}\",\n        \"user_id\": user.id,\n        \"username\": user.username,\n        \"roles\": [r.name for r in user.roles]\n    }",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 134,
      "numero_lineas": 47,
      "complejidad": 4,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, typing, app.models, app.auth, app.schemas",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\users.py",
      "nombre_archivo": "users.py",
      "elemento": "endpoint_function_21",
      "categoria": "ENDPOINT",
      "endpoint": "/users/me/profile",
      "metodo_http": "GET",
      "descripcion": "GET /users/me/profile",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "UserRead",
      "status_code": "",
      "decoradores": "@router.get(\"/users/me/profile\", response_model=UserRead)",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "@router.get(\"/users/me/profile\", response_model=UserRead)",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 22,
      "numero_lineas": 1,
      "complejidad": 4,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, app.models, app.auth, app.schemas, passlib.context, datetime, typing",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\users.py",
      "nombre_archivo": "users.py",
      "elemento": "endpoint_function_44",
      "categoria": "ENDPOINT",
      "endpoint": "/users/me/sessions",
      "metodo_http": "GET",
      "descripcion": "GET /users/me/sessions",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "List[UserSessionRead]",
      "status_code": "",
      "decoradores": "@router.get(\"/users/me/sessions\", response_model=List[UserSessionRead])",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "@router.get(\"/users/me/sessions\", response_model=List[UserSessionRead])",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 45,
      "numero_lineas": 1,
      "complejidad": 4,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, app.models, app.auth, app.schemas, passlib.context, datetime, typing",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\users.py",
      "nombre_archivo": "users.py",
      "elemento": "endpoint_function_60",
      "categoria": "ENDPOINT",
      "endpoint": "/users/me/sessions/{session_id}",
      "metodo_http": "DELETE",
      "descripcion": "DELETE /users/me/sessions/{session_id}",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "@router.delete(\"/users/me/sessions/{session_id}\")",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "@router.delete(\"/users/me/sessions/{session_id}\")",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 61,
      "numero_lineas": 1,
      "complejidad": 4,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, app.models, app.auth, app.schemas, passlib.context, datetime, typing",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "route",
      "ruta": "app\\routers\\users.py",
      "nombre_archivo": "users.py",
      "elemento": "endpoint_function_87",
      "categoria": "ENDPOINT",
      "endpoint": "/users/me/change-password",
      "metodo_http": "POST",
      "descripcion": "POST /users/me/change-password",
      "summary": "",
      "description": "",
      "tags": "",
      "response_model": "",
      "status_code": "",
      "decoradores": "@router.post(\"/users/me/change-password\")",
      "parametros": "",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "",
      "codigo_limpio": "@router.post(\"/users/me/change-password\")",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 88,
      "numero_lineas": 1,
      "complejidad": 4,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, app.models, app.auth, app.schemas, passlib.context, datetime, typing",
      "router_padre": "router",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": false,
      "es_decorador": false
    },
    {
      "tipo": "getter",
      "ruta": "app\\routers\\users.py",
      "nombre_archivo": "users.py",
      "elemento": "get_current_user_profile",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n get_current_user_profile(user: User)",
      "summary": "Obtiene el perfil del usuario actual",
      "description": "Obtiene el perfil del usuario actual | Tipo: getter | Complejidad: 1",
      "tags": "router.get('/users/me/profile', response_model=UserRead)",
      "response_model": "",
      "status_code": "",
      "decoradores": "router.get('/users/me/profile', response_model=UserRead)",
      "parametros": "user",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"user\": \"User\"}",
      "codigo_limpio": "async def get_current_user_profile(\n    user: User = Depends(current_active_user)\n):\n    \"\"\"Obtiene el perfil del usuario actual\"\"\"\n    return UserRead(\n        id=user.id,\n        email=user.email,\n        username=user.username,\n        first_name=user.first_name,\n        last_name=user.last_name,\n        phone=user.phone,\n        avatar_url=user.avatar_url,\n        bio=user.bio,\n        is_active=user.is_active,\n        is_superuser=user.is_superuser,\n        is_verified=user.is_verified,\n        created_at=user.created_at,\n        last_login=user.last_login,\n        roles=[role.name for role in user.roles]\n    )\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 23,
      "numero_lineas": 20,
      "complejidad": 1,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, app.models, app.auth, app.schemas, passlib.context, datetime, typing",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "getter",
      "ruta": "app\\routers\\users.py",
      "nombre_archivo": "users.py",
      "elemento": "get_my_sessions",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n get_my_sessions(user: User, session: AsyncSession)",
      "summary": "Obtiene las sesiones activas del usuario actual",
      "description": "Obtiene las sesiones activas del usuario actual | Tipo: getter | Complejidad: 1",
      "tags": "router.get('/users/me/sessions', response_model=List[UserSessionRead])",
      "response_model": "",
      "status_code": "",
      "decoradores": "router.get('/users/me/sessions', response_model=List[UserSessionRead])",
      "parametros": "user, session",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"user\": \"User\", \"session\": \"AsyncSession\"}",
      "codigo_limpio": "async def get_my_sessions(\n    user: User = Depends(current_active_user),\n    session: AsyncSession = Depends(get_async_session)\n):\n    \"\"\"Obtiene las sesiones activas del usuario actual\"\"\"\n    result = await session.execute(\n        select(UserSession)\n        .where(UserSession.user_id == user.id)\n        .where(UserSession.is_active == True)\n        .order_by(UserSession.created_at.desc())\n    )\n    sessions = result.scalars().all()\n    return sessions\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 46,
      "numero_lineas": 13,
      "complejidad": 1,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, app.models, app.auth, app.schemas, passlib.context, datetime, typing",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\routers\\users.py",
      "nombre_archivo": "users.py",
      "elemento": "revoke_session",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n revoke_session(session_id: int, user: User, session: AsyncSession)",
      "summary": "Revoca una sesi√≥n espec√≠fica del usuario",
      "description": "Revoca una sesi√≥n espec√≠fica del usuario | Tipo: function | Complejidad: 2",
      "tags": "router.delete('/users/me/sessions/{session_id}')",
      "response_model": "",
      "status_code": "",
      "decoradores": "router.delete('/users/me/sessions/{session_id}')",
      "parametros": "session_id, user, session",
      "parametros_query": "session_id",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"session_id\": \"int\", \"user\": \"User\", \"session\": \"AsyncSession\"}",
      "codigo_limpio": "async def revoke_session(\n    session_id: int,\n    user: User = Depends(current_active_user),\n    session: AsyncSession = Depends(get_async_session)\n):\n    \"\"\"Revoca una sesi√≥n espec√≠fica del usuario\"\"\"\n    result = await session.execute(\n        select(UserSession)\n        .where(UserSession.id == session_id)\n        .where(UserSession.user_id == user.id)\n    )\n    user_session = result.scalar_one_or_none()\n    \n    if not user_session:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"Session not found\"\n        )\n    \n    user_session.is_active = False\n    user_session.revoked_at = datetime.utcnow()\n    await session.commit()\n    \n    return {\"message\": \"Session revoked successfully\"}\n",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 62,
      "numero_lineas": 24,
      "complejidad": 2,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, app.models, app.auth, app.schemas, passlib.context, datetime, typing",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    },
    {
      "tipo": "function",
      "ruta": "app\\routers\\users.py",
      "nombre_archivo": "users.py",
      "elemento": "change_password",
      "categoria": "FUNCTION",
      "endpoint": "",
      "metodo_http": "",
      "descripcion": "Async Funci√≥n change_password(request: ChangePasswordRequest, user: User, session: AsyncSession)",
      "summary": "Cambia la contrase√±a del usuario actual",
      "description": "Cambia la contrase√±a del usuario actual | Tipo: function | Complejidad: 2",
      "tags": "router.post('/users/me/change-password')",
      "response_model": "",
      "status_code": "",
      "decoradores": "router.post('/users/me/change-password')",
      "parametros": "request, user, session",
      "parametros_query": "",
      "parametros_path": "",
      "parametros_body": "",
      "tipos_parametros": "{\"request\": \"ChangePasswordRequest\", \"user\": \"User\", \"session\": \"AsyncSession\"}",
      "codigo_limpio": "async def change_password(\n    request: ChangePasswordRequest,\n    user: User = Depends(current_active_user),\n    session: AsyncSession = Depends(get_async_session)\n):\n    \"\"\"Cambia la contrase√±a del usuario actual\"\"\"\n    # Verificar contrase√±a actual\n    if not pwd_context.verify(request.current_password, user.hashed_password):\n        raise HTTPException(\n            status_code=status.HTTP_400_BAD_REQUEST,\n            detail=\"Current password is incorrect\"\n        )\n    \n    # Hash nueva contrase√±a\n    user.hashed_password = pwd_context.hash(request.new_password)\n    await session.commit()\n    \n    return {\"message\": \"Password changed successfully\"}",
      "dependencias": "",
      "tecnologias": "fastapi, sqlalchemy",
      "linea_inicio": 89,
      "numero_lineas": 18,
      "complejidad": 2,
      "imports": "fastapi, sqlalchemy.ext.asyncio, sqlalchemy, app.models, app.auth, app.schemas, passlib.context, datetime, typing",
      "router_padre": "",
      "middlewares": "",
      "event_handlers": "",
      "include_routers": "[]",
      "responses": "",
      "ejemplos": "",
      "validaciones": "",
      "es_async": true,
      "es_decorador": false
    }
  ],
  "metadatos": {
    "fecha_analisis": "2025-11-12T20:01:19.175025",
    "version_analyzer": "4.0.0",
    "ruta_proyecto": ".",
    "total_registros": 81
  }
}